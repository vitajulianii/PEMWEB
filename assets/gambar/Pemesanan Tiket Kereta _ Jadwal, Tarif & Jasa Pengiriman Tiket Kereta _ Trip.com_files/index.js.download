define("common/search_box",["cQueryPro","cQueryPlugs","baseI18n","CIDate","cDatePickerV2"],function(t,i,e,a,r){function n(i,e,a){t.jsonp("/trains/tool/eslog?keyword="+encodeURIComponent(encodeURIComponent(i))+"&index="+e+"&content="+a)}window.htmlEncode=function(t){var i=document.createElement("div");return i.appendChild(document.createTextNode(t)),i.innerHTML};var s={suggestion:'<div class="pop_area" style="position:relative; float:left;"><h4 class="area_tit">'+addressMessageConfig.cityname.suggestion+'</h4><ul class="area_list destinations_list">   {{enum(key,arr) data}}     {{each arr}}         <li><a href="###" title="${display}" data="${data}">${display}</a></li>     {{/each}}     {{/enum}}</ul></div>',suggestionStyle:".top-destinations{background-color:#fff;width:362px;overflow:hidden}.top-destinations dl{font-family:arial;font-weight:bold;width:360px;padding-bottom:11px;border:solid 1px #ddd}.top-destinations dt{color:#84a8e5;font-size:11px;line-height:21px;height:21px;margin-bottom:11px;padding-left:8px;border-bottom:1px solid #ddd}.top-destinations dd{display:inline-block; _display:block; overflow:hidden}.top-destinations dd a{color:#1f3370;font-size:11px;line-height:17px;text-decoration:none !important;width:82px;height:17px;overflow:hidden;float:left;padding-left:8px;display:block}.top-destinations dd a:hover{background-color:#cedcf5}",filter:'<div id="address-selector" class="address-selector" >		<dl id="address_warp">			<dt id="address_message" style="">				{{if hasResult}}{{tmpl message.filterResult}}{{else}}{{tmpl message.noFilterResult}}{{/if}}			</dt>			<dd id="address_list"  class="c_address_list">			{{each (i,item) list}}				{{if i==0}}					<a style="display: block;" data="${data}" >${right}</a>				{{else}}					<a style="display: block;"  data="${data}" >${right}</a>				{{/if}}			{{/each}}			</dd>		</dl></div>',filterStyle:".address-selector{background-color:#fff; position: absolute; z-index:999; min-width:360px;}.address-selector dl{font-family:arial;background-color:#fff;border:solid 1px #ddd;*width: 360px;  white-space: nowrap; overflow: hidden;}.address-selector dt{color:#84a8e5;font-size:11px;line-height:21px;height:21px;padding-left:8px;border-bottom:1px solid #ddd}.address-selector dd {position: relative;}.address-selector dd a{color:#000082;font-size:11px;text-align:left;text-decoration:none !important;padding-left:8px; height:25px; line-height: 25px;display:block; cursor: pointer; position: relative; overflow: hidden; white-space:nowrap; text-overflow:ellipsis; -o-text-overflow:ellipsis; }.address-selector dd .tip{padding: 0px 8px; background-color: #fff; position: absolute; display:none; z-index:99; white-space:nowrap; display:none; margin-left: -1px; height:25px; line-height: 25px; border:1px solid #ddd;}.address-selector dd em{font-style:italic; font-weight:bold;}.address-selector dd a:hover,.address-selector dd .hover{background-color:#cedcf5;}",message:{filterResult:"${htmlEncode(decodeURIComponent(val))}, "+addressMessageConfig.cityname.filterResult,noFilterResult:"${htmlEncode(decodeURIComponent(val))}, "+addressMessageConfig.cityname.noFilterResult},calendarStyles:".calendar_wrap{width:352px;background:#fff;border:solid 1px #999;overflow:hidden;font-size:12px;font-family:Verdana,Arial,Helvetica,sans-serif;-moz-box-shadow:#333 2px 2px 5px;-webkit-box-shadow:#333 2px 2px 5px;box-shadow:#333 2px 2px 5px;}.calendar_wrap a{color:#0053aa;text-decoration:none !important;border-right:1px solid #e6e6e6;}.calendar_wrap a:hover{text-decoration:underline;}#calendar0{width:175px;}#calendar1 dd{border-left:1px solid #999;}#calendar1{width:177px;}.calendar_month{float:left;text-align:center;}.calendar_title{height:24px;line-height:24px;color:#1F346B;background-color:#fff;text-align:center;}.month_prev,.month_next{width:24px;height:24px;color:#fff;background:url(//pic.english.ctrip.com/common/un_tuna_calendar_en.gif) -149px 0 no-repeat;cursor:pointer;}.month_prev{float:left;background-position:-149px 0;margin-left:5px;}.month_next{float:right;background-position:-120px 0;margin-right:5px;}.month_prev:hover{background-color:#62adf1;background-position:-178px 0;}.month_next:hover{background-color:#62adf1;background-position:-207px 0;}.calendar_day{overflow:hidden;margin:0;}.calendar_day dd{margin:0;padding:0;float:left;font-family:Tohoma,Arial,Helvetica,sans-serif}#calendar1 dl{border-left:1px solid #ccc;padding-bottom:30px;margin-bottom:-30px;}.calendar_month dt{float:left;width:25px;height:22px;line-height:20px;color:#fff;background-color:#84A8E6;}.calendar_month .weekend{font-weight:bold;color:#f90;}.calendar_day a{float:left;width:23px;height:24px;line-height:24px;margin-bottom:1px;padding-right:1px;font-size:14px;color:#18376D;background-color:#fff;cursor:pointer;}.calendar_day .today{font-weight:bold;color:#0053AA;}#calendar1 .day6{border-right:1px solid #84A8E6;}.calendar_day dt.day0,.calendar_day dt.day6{color:#D0DBF9;}.calendar_day a:hover{background-color:#CEDCF5;text-decoration:none;}.calendar_day .day_over,.calendar_day .day_no{font-weight:normal;color:#9a9a9a;outline:none;cursor:default;}.calendar_day .day_over:hover,.calendar_day .day_no:hover{background:#fff;}.calendar_day .day_selected{background:#84A8E5;color:#fff;}.calendar_day .day_selected:hover{background:#CEDCF5;color:#1F3370;font-weight:bold;}.c_calender_date{display:inline-block;color:#666;text-align:right;position:absolute;z-index:1;}",calendarTemplate:{body:t.tmpl.render('<dl class="calendar_day"><dt class="day0">${weekday7}</dt><dt>${weekday1}</dt><dt>${weekday2}</dt><dt>${weekday3}</dt><dt>${weekday4}</dt><dt>${weekday5}</dt><dt class="day6">${weekday6}</dt><dd>{$dates}</dd></dl>',MLang.Calendar),calendar:'<div class="calendar_month${monthclass}"><div class="calendar_title">${title}</div><dl class="calendar_day">'+t.tmpl.render('<dt class="weekend">${weekday7}</dt><dt>${weekday1}</dt><dt>${weekday2}</dt><dt>${weekday3}</dt><dt>${weekday4}</dt><dt>${weekday5}</dt><dt class="weekend">${weekday6}</dt>',MLang.Calendar)+'<dd>{{each data}}{{if isfestival}}<a href="javascript:void(0);" ${classes}><span class="c_day_festival" ${attr}>${day}</span>{{else}}<a href="javascript:void(0);" ${classes} ${attr}>${day}{{/if}}</a>{{/each}}</dd></dl></div>',formatHead:function(t,i){return MLang.ShowMonth(t,i)}}},o="/trains/Home/GetTrainStation?keyWord=${key}",l=function(i,e){var a={css:{DepartureCity:"#DepartureCity",DepartureStation:"#DepartureStation",DepartureCityPinyin:"#DepartureCityPinyin",ArrivalCity:"#ArrivalCity",ArrivalStation:"#ArrivalStation",ArrivalCityPinyin:"#ArrivalCityPinyin",DepartDate:"#DepartDate",HidDepartDate:"#HidDepartDate",TrainNo:"#TrainNo",SwitchDirIcon:".icon-dir-switch",SearchSubmit:"#SearchSubmit",TrainForm:"#TrainForm",SearchBoxArg:"#searchboxArg"},config:{calendarMinDate:0,calendarMaxDate:59,calendarTipText:"yyyy-mm-dd",calendarTitle:"yyyy년m월",LanguageCode:"",SiteCode:""},data:{ArrivalCity:"北京",ArrivalStation:"北京",DepartureCity:"上海",DepartureStation:"上海"}};this.el=i,this.opts=t.extend(a,e),this.ui={},this.data={},this.instances={}};l.prototype={constructor:l,init:function(){this._initEl(),this._initSearchForm(),this._initComponents(),this.bindEvent()},_initEl:function(){var t=this.opts.css;this.ui.DepartureCity=this.el.find(t.DepartureCity),this.ui.DepartureStation=this.el.find(t.DepartureStation),this.ui.DepartureCityPinyin=this.el.find(t.DepartureCityPinyin),this.ui.ArrivalCity=this.el.find(t.ArrivalCity),this.ui.ArrivalStation=this.el.find(t.ArrivalStation),this.ui.ArrivalCityPinyin=this.el.find(t.ArrivalCityPinyin),this.ui.DepartDate=this.el.find(t.DepartDate),this.ui.HidDepartDate=this.el.find(t.HidDepartDate),this.ui.TrainNo=this.el.find(t.TrainNo),this.ui.SearchSubmit=this.el.find(t.SearchSubmit),this.ui.TrainForm=this.el.find(t.TrainForm),this.ui.SearchBoxArg=this.el.find(t.SearchBoxArg),this.ui.SwitchDirIcon=this.el.find(t.SwitchDirIcon)},_initComponents:function(){var i=this,e=this.opts.css,l=this.opts.config,d=this.ui.DepartureCity.regMod("address","1.0",{name:e.DepartureCity.slice(1),isFocusNext:!0,relate:{pinyin:this.ui.DepartureStation},source:{suggestion:suggestionTrain1,alias:["pinyin","name","jp"]},jsonpFilter:o,styles:s.suggestionStyle,template:{suggestion:s.suggestion,filter:s.filter,filterStyle:s.filterStyle},message:s.message}),u=null,c=!1;d.method("bind","change",function(){u=arguments[1]&&arguments[1].data?arguments[1].data:null}),d.method("bind","userinput",function(e,a){var r,s=!1;arguments[1]&&arguments[1].data?(r=arguments[1].data.split("|"),i.ui.DepartureStation.value(r[0]),i.ui.DepartureCity.value(r[1]),s=!0,u=null):u?(r=u.split("|"),i.ui.DepartureStation.value(r[0]),i.ui.DepartureCity.value(r[1]),u=null,s=!0):c&&(i.ui.DepartureStation.value(""),i.ui.DepartureCity.value("")),c=!1,s&&(a&&a.target?n(a.value,t(a.target).index()+1,r[1]):n(a.value,1,r[1]))}),d.method("bind","enter",function(){}),d.method("bind","suggestion",function(){}),d.method("bind","filter",function(t,i){c=!0,setTimeout(function(){i.find("a").first().length&&(u=i.find("a").first().attr("data"))},0)});var h=this.ui.ArrivalCity.regMod("address","1.0",{name:e.ArrivalCity.slice(1),isFocusNext:!0,relate:{pinyin:this.ui.ArrivalStation},source:{suggestion:"kr"==l.LanguageCode?suggestionTrain2:suggestionTrain1,alias:["pinyin","name","jp"]},jsonpFilter:o,styles:s.suggestionStyle,template:{suggestion:s.suggestion,filter:s.filter,filterStyle:s.filterStyle},message:s.message});switch(h.method("bind","change",function(){u=arguments[1]&&arguments[1].data?arguments[1].data:null}),h.method("bind","userinput",function(e,a){var r,s=!1;arguments[1]&&arguments[1].data?(r=arguments[1].data.split("|"),i.ui.ArrivalStation.value(r[0]),i.ui.ArrivalCity.value(r[1]),s=!0,u=null):u?(r=u.split("|"),i.ui.ArrivalStation.value(r[0]),i.ui.ArrivalCity.value(r[1]),u=null,s=!0):c&&(i.ui.ArrivalStation.value(""),i.ui.ArrivalCity.value("")),c=!1,s&&(a&&a.target?n(a.value,t(a.target).index()+1,r[1]):n(a.value,1,r[1]))}),h.method("bind","filter",function(t,i){c=!0,setTimeout(function(){i.find("a").first().length&&(u=i.find("a").first().attr("data"))},0)}),l.SiteCode){case"sg":l.calendarTipText="dd-mm-yyyy",l.calendarTitle="dd-mm-yyyy"}var p=a.createDate(),f=p.addDays(l.calendarMinDate),m=f.addDays(l.calendarMaxDate),v=i.changeToCurrDate(this.ui.HidDepartDate.value());new r(this.ui.DepartDate,{options:{minDate:f,maxDate:m,relate:[this.ui.HidDepartDate],defaultDate:v,festivalHasDateTime:!0},listeners:{onChange:function(t,i,e,a,r,n,s){}}});var y=t("div.MOD_BOX.mod-box.mod-week-table > ul > li.active a > input");y.length&&new r(y,{options:{minDate:f,maxDate:m,relate:[this.ui.HidDepartDate],defaultDate:v,festivalHasDateTime:!0},listeners:{onChange:function(e,a,r,n,s,o,l){i.checkFormIsAvilable()?(t(this).css("cursor","wait"),i.ui.TrainForm.submit()):event.preventDefault()}}}),this.instances.DepartureCity=this.ui.DepartureCity.regMod("notice","1.0",{name:e.DepartureCity.slice(1)}),this.instances.ArrivalCity=this.ui.ArrivalCity.regMod("notice","1.0",{name:e.ArrivalCity.slice(1)}),this.instances.DepartDate=this.ui.DepartDate.regMod("notice","1.0",{name:e.DepartDate.slice(1),tips:trainMsg.DateFormatTip}),this.instances.TrainNo=this.ui.TrainNo.regMod("notice","1.0",{name:e.TrainNo.slice(1)}),window.formValidator?this.instances.formValidator=window.formValidator:(window.formValidator=t(document).regMod("validate","1.1"),this.instances.formValidator=window.formValidator)},updateHidDepartDate:function(t){if(t){var i=this.changeToCurrDate(t);i?this.ui.HidDepartDate.value(i.toFormatString("MM-dd-yyyy")):this.ui.HidDepartDate.value(t)}},removeFormErrorState:function(){this.ui.DepartureCity.removeClass("f_error"),this.ui.ArrivalCity.removeClass("f_error"),this.ui.DepartDate.removeClass("f_error"),this.ui.TrainNo.removeClass("f_error")},changeToDateByLang:function(){var t=this.opts.config;switch(t.SiteCode){case"kr":String.prototype.toDate=this.toKRDate,String.prototype.isDate=this.isKRDate;break;case"sg":String.prototype.toDate=this.toSGDate,String.prototype.isDate=this.isSGDate}},isKRDate:function(){var t=this.match(/^(\d{4})-(\d{1,2}|[a-z]{3,})-(\d{1,2})$/i);if(t){var i=t[2]._toMonth();if(null===i)return!1;var e=t[1].toInt(),a=t[3].toInt(),r=new Date(e,i,a);if(r.getFullYear()==e&&r.getMonth()==i&&r.getDate()==a)return!0}return!1},toKRDate:function(){var t=this.match(/^(\d{4})-(\d{1,2}|[a-z]{3,})-(\d{1,2})( \d{1,2}:\d{1,2}:\d{1,2}(\.\d+)?)?$/i);if(t){var i=t[2]._toMonth();if(null===i)return null;var e=t[1].toInt(),a=t[3].toInt(),r=new Date(e,i,a);if(r.getFullYear()==e&&r.getMonth()==i&&r.getDate()==a)return r}return null},isSGDate:function(){var t=this.match(/^(\d{1,2})-(\d{1,2}|[a-z]{3,})-(\d{4})$/i);if(t){var i=t[2]._toMonth();if(null===i)return!1;var e=t[3].toInt(),a=t[1].toInt(),r=new Date(e,i,a);if(r.getFullYear()==e&&r.getMonth()==i&&r.getDate()==a)return!0}return!1},toSGDate:function(){var t=this.match(/^(\d{1,2})-(\d{1,2}|[a-z]{3,})-(\d{4})( \d{1,2}:\d{1,2}:\d{1,2}(\.\d+)?)?$/i);if(t){var i=t[2]._toMonth();if(null===i)return null;var e=t[3].toInt(),a=t[1].toInt(),r=new Date(e,i,a);if(r.getFullYear()==e&&r.getMonth()==i&&r.getDate()==a)return r}return null},isCNDate:function(){return/^(\d{4})-(\d{1,2}|[a-z]{3,})-(\d{1,2})$/i.test(this)},toCNDate:function(){var t=this.match(/^(\d{4})-(\d{1,2})-(\d{1,2})( \d{1,2}:\d{1,2}:\d{1,2}(\.\d+)?)?$/);if(t){var i=t[1].toInt(),e=t[2].toInt()-1,a=t[3].toInt(),r=new Date(i,e,a);if(r.getFullYear()==i&&r.getMonth()==e&&r.getDate()==a)return r}return null},checkFormIsAvilable:function(){if(this.changeToDateByLang(),this.removeFormErrorState(),this.instances.DepartureCity.method("isEmpty"))return this.instances.formValidator.method("show",{$obj:this.ui.DepartureCity,data:trainMsg.DepartureCity,hideEvent:"blur",isFocus:!0,removeErrorClass:!0}),!1;if(this.instances.ArrivalCity.method("isEmpty"))return this.instances.formValidator.method("show",{$obj:this.ui.ArrivalCity,data:trainMsg.ArrivalCity,hideEvent:"blur",isFocus:!0,removeErrorClass:!0}),!1;var t=this.ui.DepartureCity.value(),i=this.ui.ArrivalCity.value();return t==i?(this.instances.formValidator.method("show",{$obj:this.ui.ArrivalCity,data:trainMsg.same_city,hideEvent:"blur",isFocus:!0,removeErrorClass:!0}),!1):(this._saveSearchForm(),!0)},_saveSearchForm:function(){for(var t=0,i=this._initFieldsArr.length;i>t;t++)if(this.ui[this._initFieldsArr[t]])try{cQuery.storage.set(this._initFieldsArr[t],this.ui[this._initFieldsArr[t]].value())}catch(e){}},_initFieldsArr:["DepartureCity","ArrivalCity","DepartDate","TrainNo","DepartureCityPinyin","ArrivalCityPinyin","DepartureStation","ArrivalStation","HidDepartDate"],_initSearchForm:function(){var i=0,e=this._initFieldsArr.length,r=this.opts.data,n=(this.opts.config,a.createDate().addDays(1)),s=a.toDisplayText(n).yyyyMMdd,o=0;if(t.trim(this.ui[this._initFieldsArr[0]].value()))return!1;for(;e>i;i++)if(this.ui[this._initFieldsArr[i]])try{var l=cQuery.storage.get(this._initFieldsArr[i]);null!=l&&"undefined"!=typeof l&&this.ui[this._initFieldsArr[i]].value(l)}catch(d){}t.trim(this.ui.ArrivalCity.value())||(this.ui.ArrivalCity.value(r.ArrivalCity),this.ui.ArrivalStation.value(r.ArrivalStation)),t.trim(this.ui.DepartureCity.value())||(this.ui.DepartureCity.value(r.DepartureCity),this.ui.DepartureStation.value(r.DepartureStation)),t.trim(this.ui.DepartDate.value())?(o=this.changeToCurrDate(t.trim(this.ui.HidDepartDate.value())).getTime(),o<=n.getTime()?(this.ui.DepartDate.value(s),this.ui.HidDepartDate.value(n.toFormatString("MM-dd-yyyy"))):this.ui.DepartDate.value(a.toDisplayText(a.createDate(this.ui.HidDepartDate.value())).yyyyMMdd)):this.ui.DepartDate.value(s)},changeToCurrDate:function(t){var i=(this.opts.config,null);return t?(i=a.createDate(t),i||(i=(new Date).addDays(1)),i):(new Date).addDays(1)},switchDir:function(){var t=this.ui.DepartureCity.value(),i=this.ui.DepartureStation.value();this.ui.DepartureCity.value(this.ui.ArrivalCity.value()),this.ui.DepartureStation.value(this.ui.ArrivalStation.value()),this.ui.ArrivalStation.value(i),this.ui.ArrivalCity.value(t)},bindEvent:function(){var i=this;this.ui.SearchSubmit.on("click",function(e){i.checkFormIsAvilable()?(t(this).css("cursor","wait"),i.ui.TrainForm.submit()):e.preventDefault()}),this.ui.SwitchDirIcon.length&&this.ui.SwitchDirIcon.bind("click",function(){i.switchDir()})}};var d=function(i,e){var a={css:{DepartureCity:"#DepartureCity",DepartureCityPinyin:"#DepartureCityPinyin",DepartureStation:"#DepartureStation",DepartureStationPinyin:"#DepartureStationPinyin",ArrivalCity:"#ArrivalCity",ArrivalStation:"#ArrivalStation",ArrivalCityPinyin:"#ArrivalCityPinyin",DepartDate:"#DepartDate",TrainNo:"#TrainNo",SearchSubmit:".c-btn",HideSearchType:"#hidSearchType",TrainForm:"form",SearchTypeSelect:"#SearchTypeSelect",TrainLine:"#TrainLine",modTit:".mod-tit",foldActive:"fold-active",ByRouteTab:"#ByRouteTab",ByStationTab:"#ByStationTab",ByNumberTab:"#ByNumberTab"},config:{}};this.el=i,this.opts=t.extend(a,e),this.ui={},this.instances={}};d.prototype={constructor:d,init:function(){this._initEl(),this._initComponents(),this._bindEvent(),__PAGE_CONFIG__&&__PAGE_CONFIG__.base&&__PAGE_CONFIG__.base.controllerName&&"HOME"===__PAGE_CONFIG__.base.controllerName.toUpperCase()&&(document.getElementById("SearchTypeSelect").selectedIndex=0,t("#hidSearchType").val("1"))},_initEl:function(){var t=this.opts.css;this.ui.DepartureCity=this.el.find(t.DepartureCity),this.ui.DepartureStation=this.el.find(t.DepartureStation),this.ui.DepartureCityPinyin=this.el.find(t.DepartureCityPinyin),this.ui.DepartureStationPinyin=this.el.find(t.DepartureStationPinyin),this.ui.ArrivalCity=this.el.find(t.ArrivalCity),this.ui.ArrivalCityPinyin=this.el.find(t.ArrivalCityPinyin),this.ui.DepartDate=this.el.find(t.DepartDate),this.ui.TrainNo=this.el.find(t.TrainNo),this.ui.SearchSubmit=this.el.find(t.SearchSubmit),this.ui.HideSearchType=this.el.find(t.HideSearchType),this.ui.TrainForm=this.el.find(t.TrainForm),this.ui.SearchTypeSelect=this.el.find(t.SearchTypeSelect),this.ui.TrainLine=this.el.find(t.TrainLine),this.ui.ByRouteTab=this.el.find(t.ByRouteTab),this.ui.ByStationTab=this.el.find(t.ByStationTab),this.ui.ByNumberTab=this.el.find(t.ByNumberTab)},_initComponents:function(){var i=this,e=this.opts.css,a=this.opts.config,r=null,l=!1,d=this.ui.DepartureCity.regMod("address","1.0",{name:e.DepartureCity.slice(1),isFocusNext:!0,relate:{pinyin:this.ui.DepartureCityPinyin},source:{suggestion:suggestionTrain1,alias:["pinyin","name","jp"]},jsonpFilter:o,styles:s.suggestionStyle,template:{suggestion:s.suggestion,filter:s.filter,filterStyle:s.filterStyle},message:s.message});d.method("bind","change",function(){r=arguments[1]&&arguments[1].data?arguments[1].data:null}),d.method("bind","userinput",function(e,a){var s,o=!1;arguments[1]&&arguments[1].data?(s=arguments[1].data.split("|"),i.ui.DepartureCityPinyin.value(s[0]),i.ui.DepartureCity.value(s[1]),o=!0,r=null):r?(s=r.split("|"),i.ui.DepartureCityPinyin.value(s[0]),i.ui.DepartureCity.value(s[1]),r=null,o=!0):l&&(i.ui.DepartureCityPinyin.value(""),i.ui.DepartureCity.value("")),l=!1,o&&(a&&a.target?n(a.value,t(a.target).index()+1,s[1]):n(a.value,1,s[1]))}),d.method("bind","filter",function(t,i){l=!0,setTimeout(function(){i.find("a").first().length&&(r=i.find("a").first().attr("data"))},0)});var u=this.ui.ArrivalCity.regMod("address","1.0",{name:e.ArrivalCity.slice(1),isFocusNext:!0,relate:{pinyin:this.ui.ArrivalCityPinyin},source:{suggestion:"kr"==a.LanguageCode?suggestionTrain2:suggestionTrain1,alias:["pinyin","name","jp"]},jsonpFilter:o,styles:s.suggestionStyle,template:{suggestion:s.suggestion,filter:s.filter,filterStyle:s.filterStyle},message:s.message});u.method("bind","change",function(){r=arguments[1]&&arguments[1].data?arguments[1].data:null,setTimeout(function(){i.ui.ArrivalCity.blur()},0)}),u.method("bind","userinput",function(e,a){var s,o=!1;arguments[1]&&arguments[1].data?(s=arguments[1].data.split("|"),i.ui.ArrivalCityPinyin.value(s[0]),i.ui.ArrivalCity.value(s[1]),o=!0,r=null):r?(s=r.split("|"),i.ui.ArrivalCityPinyin.value(s[0]),i.ui.ArrivalCity.value(s[1]),r=null,o=!0):l&&(i.ui.ArrivalCityPinyin.value(""),i.ui.ArrivalCity.value("")),l=!1,o&&(a&&a.target?n(a.value,t(a.target).index()+1,s[1]):n(a.value,1,s[1]))}),u.method("bind","filter",function(t,i){l=!0,setTimeout(function(){i.find("a").first().length&&(r=i.find("a").first().attr("data"))},0)});var c=this.ui.DepartureStation.regMod("address","1.0",{name:e.DepartureStation.slice(1),isFocusNext:!0,relate:{pinyin:this.ui.DepartureStationPinyin},source:{suggestion:"kr"==a.LanguageCode?suggestionTrain2:suggestionTrain1,alias:["pinyin","name","jp"]},jsonpFilter:o,styles:s.suggestionStyle,template:{suggestion:s.suggestion,filter:s.filter,filterStyle:s.filterStyle},message:s.message});c.method("bind","change",function(){r=arguments[1]&&arguments[1].data?arguments[1].data:null,setTimeout(function(){i.ui.DepartureStation.blur()},0)}),c.method("bind","userinput",function(e,a){var s,o=!1;arguments[1]&&arguments[1].data?(s=arguments[1].data.split("|"),i.ui.DepartureStationPinyin.value(s[0]),i.ui.DepartureStation.value(s[1]),r=null,o=!0):r?(s=r.split("|"),i.ui.DepartureStationPinyin.value(s[0]),i.ui.DepartureStation.value(s[1]),r=null,o=!0):l&&(i.ui.DepartureStationPinyin.value(""),i.ui.DepartureStation.value("")),l=!1,o&&(a&&a.target?n(a.value,t(a.target).index()+1,s[1]):n(a.value,1,s[1]))}),c.method("bind","filter",function(t,i){l=!0,setTimeout(function(){i.find("a").first().length&&(r=i.find("a").first().attr("data"))},0)}),this.instances.DepartureCity=this.ui.DepartureCity.regMod("notice","1.0",{name:e.DepartureCity.slice(1)}),this.instances.ArrivalCity=this.ui.ArrivalCity.regMod("notice","1.0",{name:e.ArrivalCity.slice(1)}),this.instances.DepartureStation=this.ui.DepartureStation.regMod("notice","1.0",{name:e.DepartureStation.slice(1)}),this.instances.TrainNo=this.ui.TrainNo.regMod("notice","1.0",{name:e.TrainNo.slice(1)}),window.formValidator?this.instances.formValidator=window.formValidator:(window.formValidator=t(document).regMod("validate","1.1"),this.instances.formValidator=window.formValidator)},removeFormErrorState:function(){this.ui.DepartureCity.removeClass("f_error"),this.ui.ArrivalCity.removeClass("f_error"),this.ui.DepartureStation.removeClass("f_error"),this.ui.TrainNo.removeClass("f_error")},checkFormIsAvilable:function(){this.removeFormErrorState();var t=this.ui.SearchTypeSelect.value();switch(t){case"1":if(this.instances.DepartureCity.method("isEmpty"))return this.instances.formValidator.method("show",{$obj:this.ui.DepartureCity,data:trainMsg.DepartureCity,hideEvent:"blur",isFocus:!0,removeErrorClass:!0}),!1;if(this.instances.ArrivalCity.method("isEmpty"))return this.instances.formValidator.method("show",{$obj:this.ui.ArrivalCity,data:trainMsg.ArrivalCity,hideEvent:"blur",isFocus:!0,removeErrorClass:!0}),!1;if(this.ui.DepartureCity.value()==this.ui.ArrivalCity.value())return this.instances.formValidator.method("show",{$obj:this.ui.ArrivalCity,data:trainMsg.same_city,hideEvent:"blur",isFocus:!0,removeErrorClass:!0}),!1;break;case"2":if(this.instances.DepartureStation.method("isEmpty"))return this.instances.formValidator.method("show",{$obj:this.ui.DepartureStation,data:trainMsg.ArrivalCity,hideEvent:"blur",isFocus:!0,removeErrorClass:!0}),!1;break;case"3":if(this.instances.TrainNo.method("isEmpty"))return this.instances.formValidator.method("show",{$obj:this.ui.TrainNo,data:trainMsg.ArrivalCity,hideEvent:"blur",isFocus:!0,removeErrorClass:!0}),!1}return!0},updateSeachTypeState:function(){var t=this.ui.SearchTypeSelect.value();switch(this.ui.ByRouteTab.removeClass("active"),this.ui.ByStationTab.removeClass("active"),this.ui.ByNumberTab.removeClass("active"),t){case"1":this.ui.ByRouteTab.addClass("active");break;case"2":this.ui.ByStationTab.addClass("active");break;case"3":this.ui.ByNumberTab.addClass("active")}this.ui.HideSearchType.value(t)},_bindEvent:function(){var i=this,e=this.opts.css;this.el.on("click",e.modTit,function(){var i=t(this).parent();i.hasClass(e.foldActive)?i.removeClass(e.foldActive):i.addClass(e.foldActive)}),this.ui.SearchTypeSelect.bind("change",function(t){i.updateSeachTypeState()}),this.ui.SearchSubmit.bind("click",function(){i.checkFormIsAvilable()&&i.ui.TrainForm.submit()})}};var u=function(i,e){var a={css:{EmailInput:".c-ipt",SubmitBtn:".c-btn",Form:"form"},i18n:{},config:{}};this.el=i,this.opts=t.extend(a,e),this.ui={},this.instances={}};return u.prototype={constructor:u,init:function(){this._initEl(),this._initComponents(),this.bindEvent()},_initEl:function(){var t=this.opts.css;this.ui.EmailInput=this.el.find(t.EmailInput),this.ui.Form=this.el.find(t.Form),this.ui.SubmitBtn=this.el.find(t.SubmitBtn)},_initComponents:function(){var i=this.opts.css;this.ui.EmailInput.length&&(this.instances.EmailInput=this.ui.EmailInput.regMod("notice","1.0",{name:i.EmailInput.slice(1),tips:this.opts.i18n.enterEmailAddress,selClass:"ipt-placeholder"},!0)),window.formValidator?this.instances.formValidator=window.formValidator:(window.formValidator=t(document).regMod("validate","1.1"),this.instances.formValidator=window.formValidator)},checkEmailIsAvilable:function(){var t=this.ui.EmailInput.value();return this.instances.EmailInput.method("isEmpty")?(this.instances.formValidator.method("show",{$obj:this.ui.EmailInput,data:this.opts.i18n.provideYourEmail,hideEvent:"blur",isFocus:!0,removeErrorClass:!0}),!1):/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(t)?!0:(this.instances.formValidator.method("show",{$obj:this.ui.EmailInput,data:this.opts.i18n.checkEmailAddressFormat,hideEvent:"blur",isFocus:!0,removeErrorClass:!0}),!1)},bindEvent:function(){var t=this;this.ui.SubmitBtn.bind("click",function(){t.checkEmailIsAvilable()&&t.ui.Form.submit()})}},{TrainSearchForm:l,GetTrainDeals:u,SearchTrainSchedule:d}}),define("common/utils",[],function(){var t=function(){var t=function(i){return i instanceof t?i:this instanceof t?void(this._wrapped=i):new t(i)},i=Array.prototype,e=Object.prototype,a=Function.prototype,r=(i.push,i.slice),n=(i.concat,e.toString),s=e.hasOwnProperty,o=Array.isArray,l=Object.keys,d=(a.bind,function(t,i,e){if(void 0===i)return t;switch(null==e?3:e){case 1:return function(e){return t.call(i,e)};case 2:return function(e,a){return t.call(i,e,a)};case 3:return function(e,a,r){return t.call(i,e,a,r)};case 4:return function(e,a,r,n){return t.call(i,e,a,r,n)}}return function(){return t.apply(i,arguments)}});t.keys=function(i){if(!t.isObject(i))return[];if(l)return l(i);var e=[];for(var a in i)t.has(i,a)&&e.push(a);return e},t.has=function(t,i){return null!=t&&s.call(t,i)},t.partial=function(i){var e=r.call(arguments,1);return function(){for(var a=0,r=e.slice(),n=0,s=r.length;s>n;n++)r[n]===t&&(r[n]=arguments[a++]);for(;a<arguments.length;)r.push(arguments[a++]);return i.apply(this,r)}},t.before=function(t,i){var e;return function(){return--t>0?e=i.apply(this,arguments):i=null,e}},t.once=t.partial(t.before,2),t.isArray=o||function(t){return"[object Array]"===n.call(t)},t.isObject=function(t){var i=typeof t;return"function"===i||"object"===i&&!!t},t.each=t.forEach=function(i,e,a){if(null==i)return i;e=d(e,a);var r,n=i.length;if(n===+n)for(r=0;n>r;r++)e(i[r],r,i);else{var s=t.keys(i);for(r=0,n=s.length;n>r;r++)e(i[s[r]],s[r],i)}return i},t.each(["Arguments","Function","String","Number","Date","RegExp"],function(i){t["is"+i]=function(t){return n.call(t)==="[object "+i+"]"}}),t.isEmpty=function(i){if(null==i)return!0;if(t.isArray(i)||t.isString(i)||t.isArguments(i))return 0===i.length;for(var e in i)if(t.has(i,e))return!1;return!0};var u={on:function(t,i,e){if(!h(this,"on",t,[i,e])||!i)return this;this._events||(this._events={});var a=this._events[t]||(this._events[t]=[]);return a.push({callback:i,context:e,ctx:e||this}),this},once:function(i,e,a){if(!h(this,"once",i,[e,a])||!e)return this;var r=this,n=t.once(function(){r.off(i,n),e.apply(this,arguments)});return n._callback=e,this.on(i,n,a)},off:function(i,e,a){var r,n,s,o,l,d,u,c;if(!this._events||!h(this,"off",i,[e,a]))return this;if(!i&&!e&&!a)return this._events=void 0,this;for(o=i?[i]:t.keys(this._events),l=0,d=o.length;d>l;l++)if(i=o[l],s=this._events[i]){if(this._events[i]=r=[],e||a)for(u=0,c=s.length;c>u;u++)n=s[u],(e&&e!==n.callback&&e!==n.callback._callback||a&&a!==n.context)&&r.push(n);r.length||delete this._events[i]}return this},trigger:function(t){if(!this._events)return this;var i=r.call(arguments,1);if(!h(this,"trigger",t,i))return this;var e=this._events[t],a=this._events.all;return e&&p(e,i),a&&p(a,arguments),this},stopListening:function(i,e,a){var r=this._listeningTo;if(!r)return this;var n=!e&&!a;a||"object"!=typeof e||(a=this),i&&((r={})[i._listenId]=i);for(var s in r)i=r[s],i.off(e,a,this),(n||t.isEmpty(i._events))&&delete this._listeningTo[s];return this}},c=/\s+/,h=function(t,i,e,a){if(!e)return!0;if("object"==typeof e){for(var r in e)t[i].apply(t,[r,e[r]].concat(a));return!1}if(c.test(e)){for(var n=e.split(c),s=0,o=n.length;o>s;s++)t[i].apply(t,[n[s]].concat(a));return!1}return!0},p=function(t,i){var e,a=-1,r=t.length,n=i[0],s=i[1],o=i[2];switch(i.length){case 0:for(;++a<r;)(e=t[a]).callback.call(e.ctx);return;case 1:for(;++a<r;)(e=t[a]).callback.call(e.ctx,n);return;case 2:for(;++a<r;)(e=t[a]).callback.call(e.ctx,n,s);return;case 3:for(;++a<r;)(e=t[a]).callback.call(e.ctx,n,s,o);return;default:for(;++a<r;)(e=t[a]).callback.apply(e.ctx,i);return}},f={listenTo:"on",listenToOnce:"once"};return t.each(f,function(i,e){u[e]=function(e,a,r){var n=this._listeningTo||(this._listeningTo={}),s=e._listenId||(e._listenId=t.uniqueId("l"));return n[s]=e,r||"object"!=typeof a||(r=this),e[i](a,r,this),this}}),u.bind=u.on,u.unbind=u.off,u}(),i=function(){function t(t){var i={content:'<i class="s-icon icon-warning-l"></i><h2 class="pop-tit">An order contains at most 5 passenger</h2>',iconContent:"",action:'<a href="javascript:;" class="c-btn btn-l ok-btn">OK</a>',i18n:{okBtn:"OK",cancelBtn:"Cancel"},css:{content:".pop-cnt",action:".pop-action",okBtn:".ok-btn",cancelBtn:".cancel-btn",closeBtn:".icon-close-btn"},okCallback:function(){this.hide()},cancelCallback:function(){this.hide()},closeCallback:function(){},viewModel:{classExtend:""},bodyTpl:'<div class="PACK_BOX pack-box pack-pop pack-pop-ico {{if classExtend}}${classExtend}{{/if}}"><div class="pop-con"><div class="pop-cnt"></div><div class="pop-action"></div><span class="pop-close"><span class="c-icon icon-close-btn"></span></span></div></div>',mashTpl:'<div class="overlay-bg"></div>'};this.opts=$.extend({},i,t),this.init()}t.prototype={constructor:t,init:function(){var t=$("body");this.$el=this.createEl($.tmpl.render(this.opts.bodyTpl,this.opts.viewModel)),this.$mash=this.createEl(this.opts.mashTpl),t.append(this.$mash),t.append(this.$el),this.render(),this.hide(),this.bindEvent()},remove:function(){this.$el&&this.$el.remove(),this.$mash&&this.$mash.remove()},show:function(t){t&&(this.opts.iconContent&&this.opts.iconContent.length>0&&(t=this.opts.iconContent.replace("{text}",t)),this.$el.find(this.opts.css.content).html(t)),this.$el.show(),this.$mash.show()},alert:function(t){var i='<i class="s-icon icon-warning-l"></i><h2 class="pop-tit">${text}</h2>',e=$.tmpl.render(i,{text:t});this.show(e)},confirm:function(t,i){var e='<i class="s-icon icon-warning-l"></i><h2 class="pop-tit">${title}</h2><p>${text}</p>',a=$.tmpl.render(e,{title:t,text:i});this.show(a)},hide:function(){this.$el.hide(),this.$mash.hide()},render:function(){var t=this.opts,i=t.css;this.$el.find(i.content).html(t.content),this.$el.find(i.action).html(t.action),this.$el.find(i.okBtn).html(t.i18n.okBtn),this.$el.find(i.cancelBtn).html(t.i18n.cancelBtn)},updateByData:function(t){this.opts=$.extend(this.opts,t),this.render()},createEl:function(t){var i=document.createElement("div");return i.innerHTML=t,$(i).children()},bindEvent:function(){var t=this,i=this.opts,e=i.css;this.$el.on("click",e.closeBtn,function(e){e.preventDefault(),t.hide(),i.closeCallback&&i.closeCallback.call(t)}).on("click",e.okBtn,function(e){
e.preventDefault(),i.okCallback&&i.okCallback.call(t)}).on("click",e.cancelBtn,function(e){e.preventDefault(),i.cancelCallback&&i.cancelCallback.call(t)})}};var i=null;return t.getInstance=function(e){return i?i:i=new t(e)},t}(),e=function(){function t(t){var i={css:{okBtn:"#btnOk",cancelBtn:"#btnCancel",closeBtn:"#btnClose",popContainer:"#popContainer"},okCallback:function(){this.hide()},cancelCallback:function(){this.hide()},closeCallback:function(){},mashTpl:'<div class="overlay-bg"></div>'};this.opts=$.extend({},i,t),this.init()}t.prototype={constructor:t,init:function(){var t=$("body");this.$el=$(this.opts.css.popContainer),this.$mash=this.createEl(this.opts.mashTpl),t.append(this.$mash),this.bindEvent()},show:function(){this.$el.show(),this.$mash.show()},hide:function(){this.$el.hide(),this.$mash.hide()},createEl:function(t){var i=document.createElement("div");return i.innerHTML=t,$(i).children()},bindEvent:function(){var t=this,i=this.opts,e=i.css;$(e.closeBtn).bind("click",function(e){e.preventDefault(),t.hide(),i.closeCallback&&i.closeCallback.call(t)}),$(e.okBtn).bind("click",function(e){e.preventDefault(),i.okCallback&&i.okCallback.call(t)})}};var i=null;return t.getInstance=function(e){return i?i:i=new t(e)},t}(),a=function(){function t(t){var i={i18n:{loading:require.utils.getPageConfig().i18n.processing||"Processing..."}};this.opts=$.extend(i,t),this.init()}var i='<div class="loading-item"><div class="loading-cnt"><div class="loading-brick"><i class="c-icon icon-loading-64"></i><div class="loading-txt">${loading}</div></div></div></div>',e='<div class="overlay-bg"></div>';t.prototype={constructor:t,init:function(){var t=$("body");this.$el=this.createEl($.tmpl.render(i,this.opts.i18n)),this.$mash=this.createEl(e),t.append(this.$mash),t.append(this.$el),this.hide()},getMaxIndex:function(){var t=0;return $("body *").each(function(i){t=Math.max(t,parseInt(i.css("zIndex"),10)||0)}),t},show:function(){var t=this.getMaxIndex();this.$el.css("zIndex",t+2).show(),this.$mash.css("zIndex",t+1).show()},hide:function(){this.$el.hide(),this.$mash.hide()},createEl:function(t){var i=document.createElement("div");return i.innerHTML=t,$(i).children()}};var a=null;return t.getInstance=function(i){return a?a:a=new t(i)},t}(),r=function(){function t(t){var i={content:"",css:{content:".pop-cnt-tip",closeBtn:".icon-closed-btn-tip"},closeCallback:function(){this.hide()},viewModel:{classExtend:""},bodyTpl:'<div c-layout="tile" class="pack-tip-info pack-price-detail {{if classExtend}}${classExtend}{{/if}}" style="position:absolute;"><div class="pop-cnt pop-cnt-tip"></div></div></div>',closeTpl:'<span class="t-icons icon-closed icon-closed-btn-tip"></span>'};this.opts=$.extend({},i,t),this.init()}t.prototype={constructor:t,init:function(){var t=$("body");this.$el=this.createEl($.tmpl.render(this.opts.bodyTpl,this.opts.viewModel)),t.append(this.$el),this.render(),this.hide(),this.bindEvent()},createEl:function(t){var i=document.createElement("div");return i.innerHTML=t,$(i).children()},render:function(){var t=this.opts,i=t.css;this.$el.find(i.content).html(t.content)},hide:function(){this.$el.hide()},show:function(t,i){if(t){i&&this.$el.find(this.opts.css.content).html(this.opts.closeTpl+i);var e=window.innerWidth,a=this.$el.width(),r=t.offset(),n=r.top,s=r.left,o=s+10,l=o+a-e;l>0&&(o-=l+40),this.$el.css({left:o,top:n+15}),this.$el.show()}},bindEvent:function(){var t=this,i=this.opts,e=i.css;this.$el.on("click",e.closeBtn,function(e){e.preventDefault(),t.hide(),i.closeCallback&&i.closeCallback.call(t)})}};var i=null;return t.getInstance=function(e){return i?i:i=new t(e)},t}(),n=function(t,i){var e={viewModel:{defaultItem:0},css:{item:"a",disable:"tab-disabled",active:"active"},itemUpdateCallback:function(t,i){},disableCallback:function(t,i){}};this.opts=$.extend(e,i),this.el=t[0],this.$el=t,this.init()};n.prototype={constructor:n,init:function(){this.showDefaultItem(),this.bindEvent()},showDefaultItem:function(){var t=this.opts,i=this.opts.css,e=this.$el.find(i.item),a=e.removeClass(i.active).eq(t.viewModel.defaultItem).addClass(i.active);this.callItemCallback(a,t.viewModel.defaultItem)},callItemCallback:function(t,i){this.opts.itemUpdateCallback&&this.opts.itemUpdateCallback.call(this,t,i)},bindEvent:function(){var t=this,i=this.opts,e=i.css;this.$el.on("click",e.item,function(i){i.preventDefault();var a=$(this),r=a.index();a.hasClass(e.disable)?t.opts.disableCallback&&t.opts.disableCallback.call(t,a,r):a.hasClass(e.active)||(t.callItemCallback(a,r),a.addClass(e.active).siblings().removeClass(e.active))})}};var s={isEmail:function(t){var i=/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;return i.test(t)},isPassport:function(t){return/^\w+$/.test(t)},isPassword:function(t){var i=/^[a-zA-Z0-9]{6,20}$/;return i.test(t)},isMobile:function(t){var i=/^(1)\d{10}$/;return i.test(t)},isChinese:function(t){var i=/^[\u4e00-\u9fff]{0,}$/;return i.test(t)},isEnglish:function(t){var i=/^[A-Za-z]+$/;return i.test(t)},isGivenName:function(t){var i=/^[A-Za-z ]+$/;return i.test(t)},isZip:function(t){var i=/^\d{6}$/;return i.test(t)},isCHNCardId:function(t){if(!/^[0-9]{17}[X0-9]$/.test(t))return!1;t=t.toString();var i,e,a;switch(i=7*parseInt(t.substr(0,1))+9*parseInt(t.substr(1,1))+10*parseInt(t.substr(2,1)),i=i+5*parseInt(t.substr(3,1))+8*parseInt(t.substr(4,1))+4*parseInt(t.substr(5,1)),i=i+2*parseInt(t.substr(6,1))+1*parseInt(t.substr(7,1))+6*parseInt(t.substr(8,1)),i=i+3*parseInt(t.substr(9,1))+7*parseInt(t.substr(10,1))+9*parseInt(t.substr(11,1)),i=i+10*parseInt(t.substr(12,1))+5*parseInt(t.substr(13,1))+8*parseInt(t.substr(14,1)),i=i+4*parseInt(t.substr(15,1))+2*parseInt(t.substr(16,1)),e=i%11,a=2==e?t.substr(17,1).toUpperCase():parseInt(t.substr(17,1)),e){case 0:if(1!=a)return!1;break;case 1:if(0!=a)return!1;break;case 2:if("X"!=a)return!1;break;case 3:if(9!=a)return!1;break;case 4:if(8!=a)return!1;break;case 5:if(7!=a)return!1;break;case 6:if(6!=a)return!1;break;case 7:if(5!=a)return!1;break;case 8:if(4!=a)return!1;break;case 9:if(3!=a)return!1;break;case 10:if(2!=a)return!1}return!0}},o=function(t,i){var e={css:{backTopIcon:".back-top"},data:{scrollPrecent:.3}};this.$el=t,this.opts=$.extend(e,i),this.data={},this.ui={},this.init()};o.prototype={constructor:o,init:function(){var t=this.opts.css;this.ui.$window=$(window),this.ui.$document=$(document),this.ui.backTopIcon=this.$el.find(t.backTopIcon),this.updateWindow(),this.checkScroll(),this.bindEvent()},checkScroll:function(){this.ui.$document.scrollTop()>this.data.windowHeight*this.opts.data.scrollPrecent?this.ui.backTopIcon.show():this.ui.backTopIcon.hide()},goTop:function(){this.ui.$document.scrollTop(0),this.ui.backTopIcon.hide()},updateWindow:function(){this.data.windowHeight=$(window).height()},bindEvent:function(){var t=this,i=this.opts.css;this.ui.$window.on("resize",function(){t.updateWindow(),t.checkScroll()}),this.ui.$window.on("scroll",function(){t.checkScroll()}),this.$el.on("click",i.backTopIcon,function(i){i.preventDefault(),t.goTop()})}};var l=function(){var t=location.search,i=new Object;if(-1!==t.indexOf("?")){var e=t.substr(1).split("&");e.map(function(t){i[t.split("=")[0]]=decodeURI(t.split("=")[1])})}return i},d=function(){var t=location.hash,i=new Object;if(-1!==t.indexOf("#")){var e=t.substr(1).split("&");e.map(function(t){i[t.split("=")[0]]=decodeURI(t.split("=")[1])})}return i},u=function(t){var i,e=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return console.log(document.cookie),console.log(document.cookie.match(e)),(i=document.cookie.match(e))?unescape(i[2]):null},c=function(){var t=__PAGE_CONFIG__&&__PAGE_CONFIG__.base&&__PAGE_CONFIG__.base.IsUsingNewLoginMask&&"TRUE"===__PAGE_CONFIG__.base.IsUsingNewLoginMask.toUpperCase();return t},h=function(){var t=$("#i18naccountpcsdk_secrectkey");return t&&t.value()},p=function(t,i){if(i=i||{roundToDecimalPlace:2,decimalSymbol:".",digitGroupSymbol:",",negativeSymbol:"-"},t=Number(t),isNaN(t))return"0";var e=t.toString(),a=e.split(".");a&&2==a.length&&a[1]&&1==a[1].length&&(i.roundToDecimalPlace=1);var r,n=t.toString(),s=/-/.test(n),o=/\./.test(n),l=0;o?(t=t.toFixed(i.roundToDecimalPlace),r=String(t).split("."),l=s?r[0].toString().replace(i.negativeSymbol,""):r[0].toString()):l=s?n.replace(i.negativeSymbol,""):n;for(var d=0;d<Math.floor((l.length-(1+d))/3);d++)l=l.substring(0,l.length-(4*d+3))+i.digitGroupSymbol+l.substring(l.length-(4*d+3));return s&&(l=i.negativeSymbol+l),o&&(l=l+i.decimalSymbol+r[1]),l},f=function(){function t(t){var i={rate:1,reserveTip:"Reserving tickets. Please wait…",orderId:0,isBook:!0,stepPercent:0,totalStep:150,step:1.5};this.opts=$.extend(i,t),this.requestPreholdSeatTimer=null,this.processBarTimer=null,this.init()}return t.prototype={constructor:t,init:function(){},_getTmpl:function(){var t=0==this.opts.stepPercent?1:100==this.opts.stepPercent?99:this.opts.stepPercent,i='<div class="progress-bar"><div class="loading-bar" style="width:'+t+'%;"><div class="loading-txt">'+this.opts.reserveTip+'</div></div><span class="percentage">'+t+"%</span></div>";return i},show:function(){this._getPreholdSeatResult();var t=this.opts.stepPercent>0?this.opts.stepPercent*this.opts.step:this.opts.step;this._process(t)},_getPreholdSeatResult:function(){if(!(this.opts.rate<=0||0==this.opts.orderId||0==this.opts.totalStep)){var t=this;t._requestPreholdSeatResult(),this.requestPreholdSeatTimer=setTimeout(function(){t._getPreholdSeatResult()},1e3*this.opts.rate)}},_process:function(t){if(0!=this.opts.totalStep&&0!=this.opts.step&&150!=t){var i=this,e=__PAGE_PARAM__&&__PAGE_PARAM__.preHoldSeatTimerRate?__PAGE_PARAM__.preHoldSeatTimerRate:150;t>75&&120>t?e=3*e:t>=120&&140>t?e=6*e:t>=140&&(e=9*e),t+=this.opts.step;var a=parseInt(t/i.opts.totalStep*100);a=a>=100?99:a;var r=a.toString()+"%";$(".loading-bar").css("width",r),$(".percentage").html(r),99>a?this.processBarTimer=setTimeout(function(){i._process(t)},e):this.processBarTimer&&clearTimeout(this.processBarTimer)}},_requestPreholdSeatResult:function(){var t=this,i="/trains/order/GetPreHoldSeatResult";t._ajaxMethod(i,function(i){var e=$.parseJSON(i.responseText||{});0==e.Result?(t._clearPreholdseatRequestTimer(),t.opts.isBook?t._pay():t._gotoOrder()):1==e.Result&&(t._clearPreholdseatRequestTimer(),t._gotoOrder())},function(){t._clearPreholdseatRequestTimer(),t._gotoOrder()})},_clearPreholdseatRequestTimer:function(){this.requestPreholdSeatTimer&&clearTimeout(this.requestPreholdSeatTimer)},_pay:function(){var t=this,i="/trains/order/pay";t._ajaxMethod(i,function(i){var e=$.parseJSON(i.responseText);1==e.Code?$("body").append(e.Result):t._gotoOrder()},function(){t._gotoOrder()})},_gotoOrder:function(){window.location.href="/trains/order?orderId="+this.opts.orderId},_ajaxMethod:function(t,i,e){$.ajax(t,{method:"POST",context:{orderId:this.opts.orderId},async:!0,cache:!1,escape:!1,onsuccess:function(t){i(t)},onerror:function(){e()},onabort:function(){e()}})}},t}();return{ScrollBar:o,TabMini:n,PopAlert:i,PageAlert:e,PopLoading:a,PopTip:r,Events:t,validators:s,formatCurrency:p,getRequest:l,getHash:d,getCookie:u,isUsingNewLoginMask:c,getI18nAccountPCSDKSecrectKey:h,ProcessBar:f}}),define("importNotes",["cQueryPro"],function(t){return{css:{importLayer:"#trainLanguageTips",importContent:"#trainTipsContent",closeIcon:".icon-close-btn"},ui:{},options:{devImportUrl:"//pages.english.dev.sh.ctriptravel.com/trains/ImportantNotes.txt",prodImportUrl:"//pages.english.ctrip.com/trains/ImportantNotes.txt"},init:function(i){t.extend(this.options,i),this.getElements(),this.bindEvent()},getElements:function(){this.ui.importLayer=t(this.css.importLayer)},fetchNoticeData:function(){var i=this;window.__IMPORTANT_NOTICE_CALLBACK=function(t){i.updateNotice(t)},t.loader.jsonp("DEV"===this.options.globalEnv?this.options.devImportUrl:this.options.prodImportUrl)},updateNotice:function(t){if(t&&t.length)for(var i=0,e=t.length;e>i;i++)if(t[i].IsShow&&t[i].Language===this.options.LanguageCode&&t[i].Site===this.options.SiteCode){this.updateNoticeText(t[i].Content);break}},updateNoticeText:function(t){this.showLayer(),this.ui.importLayer.find(this.css.importContent).html(t)},showLayer:function(){this.ui.importLayer.show()},hideLayer:function(){this.ui.importLayer.hide()},removeLayer:function(){this.ui.importLayer.remove()},bindEvent:function(){var t=this;this.ui.importLayer.on("click",this.css.closeIcon,function(){t.hideLayer()})}}}),define("common/trains_search_v2",["cQueryPro","CIDate","cDatePickerV2","cAddress","modTrainsSearchBoxI18n"],function(t,i,e,a,r){function n(i,e,a){t.jsonp("/trains/tool/eslog?keyword="+encodeURIComponent(encodeURIComponent(i))+"&index="+e+"&content="+a)}window.htmlEncode=function(t){var i=document.createElement("div");return i.appendChild(document.createTextNode(t)),i.innerHTML};var s={i18n:r,hasTitle:!1,channel:"main",hasEurorail:!0,hasKorail:!0,hasDerail:!0,hasJprail:!0,tabIndex:0,addrJSONPUrl:"/trains/Home/GetTrainStation?keyWord=${key}",css:{DepartureCity:"#DepartureCity",DepartureStation:"#DepartureStation",DepartureCityPinyin:"#DepartureCityPinyin",ArrivalCity:"#ArrivalCity",ArrivalStation:"#ArrivalStation",ArrivalCityPinyin:"#ArrivalCityPinyin",DepartDate:"#DepartDate",HidDepartDate:"#HidDepartDate",TrainNo:"#TrainNo",SwitchDirIcon:".icon-dir-switch",SearchSubmit:"#SearchSubmit",TrainForm:"#TrainForm",SearchBoxArg:"#searchboxArg",popoverDerail:".tab-popover"},config:{calendarMinDate:0,calendarMaxDate:59,LanguageCode:"",SiteCode:""},data:r.data.default_searchbox,template:{suggestion:'<div class="pop_area" style="position:relative; float:left;"><h4 class="area_tit">'+r.locals.Top_Destinations+'</h4><ul class="area_list destinations_list">   {{enum(key,arr) data}}     {{each arr}}         <li><a href="###" title="${display}" data="${data}">${display}</a></li>     {{/each}}     {{/enum}}</ul></div>',suggestionStyle:".top-destinations{background-color:#fff;width:362px;overflow:hidden}.top-destinations dl{font-family:arial;font-weight:bold;width:360px;padding-bottom:11px;border:solid 1px #ddd}.top-destinations dt{color:#84a8e5;font-size:11px;line-height:21px;height:21px;margin-bottom:11px;padding-left:8px;border-bottom:1px solid #ddd}.top-destinations dd{display:inline-block; _display:block; overflow:hidden}.top-destinations dd a{color:#1f3370;font-size:11px;line-height:17px;text-decoration:none !important;width:82px;height:17px;overflow:hidden;float:left;padding-left:8px;display:block}.top-destinations dd a:hover{background-color:#cedcf5}",filter:'<div id="address-selector" class="address-selector" >		<dl id="address_warp">			<dt id="address_message" style="">				{{if hasResult}}{{tmpl message.filterResult}}{{else}}{{tmpl message.noFilterResult}}{{/if}}			</dt>			<dd id="address_list"  class="c_address_list">			{{each (i,item) list}}				{{if i==0}}					<a style="display: block;" data="${data}" >${right}</a>				{{else}}					<a style="display: block;"  data="${data}" >${right}</a>				{{/if}}			{{/each}}			</dd>		</dl></div>',filterStyle:".address-selector{background-color:#fff; position: absolute; z-index:999; min-width:360px;}.address-selector dl{font-family:arial;background-color:#fff;border:solid 1px #ddd;*width: 360px;  white-space: nowrap; overflow: hidden;}.address-selector dt{color:#84a8e5;font-size:11px;line-height:21px;height:21px;padding-left:8px;border-bottom:1px solid #ddd}.address-selector dd {position: relative;}.address-selector dd a{color:#000082;font-size:11px;text-align:left;text-decoration:none !important;padding-left:8px; height:25px; line-height: 25px;display:block; cursor: pointer; position: relative; overflow: hidden; white-space:nowrap; text-overflow:ellipsis; -o-text-overflow:ellipsis; }.address-selector dd .tip{padding: 0px 8px; background-color: #fff; position: absolute; display:none; z-index:99; white-space:nowrap; display:none; margin-left: -1px; height:25px; line-height: 25px; border:1px solid #ddd;}.address-selector dd em{font-style:italic; font-weight:bold;}.address-selector dd a:hover,.address-selector dd .hover{background-color:#cedcf5;}",message:{filterResult:"${htmlEncode(decodeURIComponent(val))}, "+r.locals.filterResult,noFilterResult:"${htmlEncode(decodeURIComponent(val))}, "+r.locals.noFilterResult},body:'{{if channel === "index"}}<div class="mod-main-search clearfix"><div class="mod-search-forms">{{/if}}<div class="mod-main-search-train m-ms-train fn-search-box clearfix"><h1 class="mod-tit" {{if !hasTitle}}style="display: none;"{{/if}}>${i18n.V2_Trains_Home_Search_Trains_H2_SearchTrains}</h1><form action="/trains/List/Index" method="get" id="TrainForm"><table class="m-train-gift-addon"><tbody></tbody></table><ul class="search-items clearfix"><li class="s-item s-item-l"><label for="">${i18n.LabelText_UpperFrom} </label><input class="c-ipt ipt-borderless" type="text" name="DepartureCity" id="DepartureCity" /></li><li class="dir-switch"><a href="javascript:;"><i class="c-icon icon-dir-switch"></i></a></li><li class="s-item s-item-r"><label for="">${i18n.LabelText_UpperTo}</label><input class="c-ipt ipt-borderless" type="text" name="ArrivalCity" id="ArrivalCity" /></li><li class="s-item s-item-l"><label for="">${i18n.Home_LabelText_Depart}</label><input class="c-ipt ipt-borderless c-ipt-date" type="text" id="DepartDate" readonly="readonly" /></li><li class="s-item s-item-r"><label for="">${i18n.LabelText_TrainScheduleTitleTrainNo} (${i18n.Home_LabelText_Optional})</label><input class="c-ipt ipt-gray" type="text" name="TrainNo" id="TrainNo" placeholder="${i18n.SearchBox_LabelText_EG}"/></li></ul><div class="search-btn"><button class="c-btn btn-key btn-xl btn-book-avalible" id="SearchSubmit">${i18n.V2_Trains_Search_Button_Search}</button></div><input id="DepartureCityPinyin" type="hidden" name="DepartureCityPinyin"/><input id="ArrivalCityPinyin" type="hidden" name="ArrivalCityPinyin"/><input id="DepartureStation" type="hidden" name="DepartureStation"/><input id="ArrivalStation" type="hidden" name="ArrivalStation"/><input id="HidDepartDate" type="hidden" name="DepartDate"/><input id="searchboxArg" type="hidden" name="searchboxArg"/></form></div>{{if channel === "index"}}</div></div>{{/if}}'},hook:{search:function(){}}},o=function(i,e){var a={css:{elName:"DepartCity",relate:"#DepartCityId",errorState:"ipt-error"},alias:["name_py","name","code","alias"],i18n:{inputEmpty:"",sameInputValue:"",suggestionTitle:"",suggestionTip:""},tmpl:{},suggestionSource:"",listeners:{onChange:function(){}},jsonpFilter:""};this.options=t.extend(!0,a,e),this.$el=t(i),this.ui={},this.ui.el=i,this.init()};o.prototype={init:function(){return this.findElements(),this.initAddress(),this.initTip(),this},findElements:function(){var t=this.options.css;this.ui.relate=t.relate},getInputValue:function(){return this.ui.el.value().trim()},setInputValue:function(t){this.ui.el.value(t)},getRelateValue:function(){return this.ui.relate.value().trim()},setRelateValue:function(t){this.ui.relate.value(t)},updateUserInput:function(t,i){this.ui.el.value(t),this.ui.relate.value(i)},initAddress:function(){var i=this,e=this.options,a=e.css,r=e.tmpl;r.message.i18n=e.i18n,this.addrInstance=this.ui.el.regMod("address","1.0",{name:a.elName,isFocusNext:!0,isAutoCorrect:!1,relate:{code:this.ui.relate},offset:5,source:{alias:e.alias,suggestion:e.suggestionSource},template:r,jsonpFilter:e.jsonpFilter,message:r.message});var s=null,o=!1;this.addrInstance.method("bind","change",function(){s=arguments[1]&&arguments[1].data?arguments[1].data:null}),this.addrInstance.method("bind","userinput",function(e,a){var r,l=!1;arguments[1]&&arguments[1].data?(r=arguments[1].data.split("|"),i.ui.el.value(r[1]),i.ui.relate.value(r[0]),l=!0,s=null):s?(r=s.split("|"),i.ui.el.value(r[1]),i.ui.relate.value(r[0]),s=null,l=!0):o&&(i.ui.el.value(""),i.ui.relate.value("")),o=!1,l&&(a&&a.target?n(a.value,t(a.target).index()+1,r[1]):n(a.value,1,r[1]))}),this.addrInstance.method("bind","filter",function(t,i){o=!0,setTimeout(function(){i.find("a").first().length&&(s=i.find("a").first().attr("data"))},0)}),this.ui.el.on("focus",function(){i.hideTip()})},checkIsAvilable:function(t){var i=this.getInputValue();return i?t&&t===i?(this.showTip(this.options.i18n.sameInputValue),!1):(this.hideTip(),!0):(this.showTip(this.options.i18n.inputEmpty),!1)},createEl:function(i){var e=t(document.createElement("div"));return e.html(i),e.children()},initTip:function(){this.ui.error=this.createEl('<span class="msg-box msg-error" style="position: absolute;"></span>'),this.ui.error.hide(),this.ui.el.parent().append(this.ui.error)},showTip:function(t){this.ui.error.html(t).show(),this.ui.el.addClass(this.options.css.errorState)},hideTip:function(){this.ui.error.hide(),this.ui.el.removeClass(this.options.css.errorState)}};var l=function(i,e){var a={options:{prevInput:null,minDate:"#",maxDate:null,startDate:null,endDate:null,nextInput:null,nextInputRelate:null,nextInterval:0,relate:"",relateDisplay:"",defaultDate:null},listeners:{onBeforeShow:null,onShow:null,onChange:null},i18n:{is_empty:""}};this.options=t.extend(!0,a,e),this.$el=t(i),this.ui={el:i},this.init()};l.prototype={init:function(){return this.findElements(),this.initInputState(),this.initCalendar(),this},findElements:function(){},initInputState:function(){this.ui.el.attr("readonly","readonly")},getInputValue:function(){return this.ui.el.value().trim()},setInputValue:function(t){this.ui.el.value(t)},initCalendar:function(){this.options;this.inst=new e(this.$el,{options:this.options.options,listeners:this.options.listeners})},checkIsAvilable:function(){var t=this.getInputValue();return t?!0:(this.showTip(this.options.i18n.is_empty),!1)},showTip:function(t){}};var d=function(i){this.options=t.extend(!0,s,i),this.ui={},this.data={}};return d.prototype={constructor:d,init:function(){var t=this;return this.$el=this.render(),this.ui.el=this.$el,this.getElements(),(this.options.hasEurorail||this.options.hasKorail||this.options.hasDerail||this.options.hasJprail)&&require(["cRadioTab","modEurorailSearchBox"],function(i,e){t.initEurorailSearch(e),t.initSwitchTabs(i)}),this.initAddressInputs(),this.initCalendar(),this.bindEvents(),this._initSearchForm(),this},initSwitchTabs:function(i){var e=this,a=this.options.i18n.locals,r=[a.China_Rail],n="";this.options.hasEurorail&&r.push(a.Euro_Rail),this.options.hasKorail&&r.push(a.Ko_Rail),this.options.hasDerail&&(r.push(a.De_Rail||"德铁"),t.storage.get("_derail_popover_shown")||(n='                            <div class="tab-popover" style="                                position: absolute;                                left: 450px;                                border-radius: 2px;                                top: -25px;                                display: inline-block;                                background-color: #000000;                                opacity: 0.8;                                color: rgba(255, 255, 255, .7);                                padding: 0 19px 0 8px;                                z-index: 2;                                max-width: 160px;                                cursor: default;                            ">'+a.key_derail_searchbox_popover+'                                <i class="fi fi-close" style="                                    display: inline-block;                                    font-size: 7px;                                    position: absolute;                                    top: 4px;                                    right: 5px                                "></i>                                <div class="tab-popover-triangle" style="                                    position: absolute;                                    top: 100%;                                    left: 10px;                                    width: 0;                                    height: 0;                                    border-style: solid;                                    border-width: 5px 3px 0 3px;                                    border-color: #000000 transparent transparent transparent;                                "></div>                            </div>                        ',t.storage.set("_derail_popover_shown",1))),this.options.hasJprail&&r.push(a.Jp_Rail),"list"!==this.options.channel&&"index"!==this.options.channel?(this.data.miniSwitchTab=new i({defaultIndex:this.options.tabIndex,items:r,css:{activeState:"active",item:"a"},listeners:{load:function(t){e.switchTabView(t)},change:function(t){e.switchTabView(t)}}}),this.data.miniSwitchTab.$el.insertBefore(this.ui.TrainForm)):"index"===this.options.channel&&(this.data.largeSwitchTab=new i({defaultIndex:this.options.tabIndex,items:r,css:{activeState:"active",item:".mod-tab-cn",slash:"center"},listeners:{load:function(t){e.switchTabView(t)},change:function(t){e.switchTabView(t)}},template:'<div class="train-tab clearfix" style="position:relative">{{each(i, item) list}}<div class="mod-tab-cn {{if i%2 != 0 }} center {{/if}}{{if $data.index === i}} active{{/if}}" data-index="${i}">{{if i%2 != 0 && i != list.length-1}}<div class="line-left"></div>{{/if}}${item}{{if i%2 != 0}}<div class="line-right"></div>{{/if}}</div>{{/each}}'+n+"</div>"}),this.data.largeSwitchTab.$el.insertBefore(this.ui.TrainForm.parent()),this.ui.popoverDerail=this.data.largeSwitchTab.$el.find(this.options.css.popoverDerail),this.ui.popoverDerail&&(this.ui.popoverDerail.css({top:-this.ui.popoverDerail.height()-3}),this.ui.popoverDerail.bind("click",function(){t(this).hide()})))},switchTabView:function(t){switch(t){case 0:this.showTrains(),this.hideEurorails(),this.hideKorails(),this.hideDerails(),this.hideJprails();break;case 1:this.hideTrains(),this.options.hasEurorail?(this.showEurorails(),this.hideKorails(),this.hideDerails(),this.hideJprails()):this.options.hasKorail?(this.showKorails(),this.hideDerails(),this.hideJprails()):this.options.hasDerail?(this.showDerails(),this.hideJprails()):this.options.hasJprail&&this.showJprails();break;case 2:this.hideTrains(),this.options.hasEurorail?this.options.hasKorail?(this.showKorails(),this.hideEurorails(),this.hideDerails(),this.hideJprails()):this.options.hasDerail?(this.showDerails(),this.hideJprails(),this.hideEurorails()):this.options.hasJprail&&(this.showJprails(),this.hideEurorails()):this.options.hasKorail?this.options.hasDerail?(this.showDerails(),this.hideJprails(),this.hideKorails()):this.options.hasJprail&&(this.showJprails(),this.hideKorails()):this.options.hasDerail&&this.options.hasJprail&&(this.showJprails(),this.hideDerails());break;case 3:this.hideTrains(),this.options.hasEurorail?this.options.hasKorail?this.options.hasDerail?(this.showDerails(),this.hideJprails(),this.hideEurorails(),this.hideKorails()):this.options.hasJprail&&(this.showJprails(),this.hideEurorails(),this.hideKorails()):this.options.hasDerail&&this.options.hasJprail&&(this.showJprails(),this.hideEurorails(),this.hideKorails()):this.options.hasKorail&&this.options.hasDerail&&this.options.hasJprail&&(this.showJprails(),this.hideEurorails(),this.hideDerails());break;case 4:this.showJprails(),this.hideTrains(),this.hideEurorails(),this.hideKorails(),this.hideDerails()}},showJprails:function(){this.data.jprailSearchInst&&this.data.jprailSearchInst.$el&&this.data.jprailSearchInst.$el.show()},hideJprails:function(){this.data.jprailSearchInst&&this.data.jprailSearchInst.$el&&this.data.jprailSearchInst.$el.hide()},showEurorails:function(){this.data.eurorailSearchInst&&this.data.eurorailSearchInst.$el&&this.data.eurorailSearchInst.$el.show()},hideEurorails:function(){this.data.eurorailSearchInst&&this.data.eurorailSearchInst.$el&&this.data.eurorailSearchInst.$el.hide()},showKorails:function(){this.data.korailSearchInst&&this.data.korailSearchInst.$el&&this.data.korailSearchInst.$el.show()},hideKorails:function(){this.data.korailSearchInst&&this.data.korailSearchInst.$el&&this.data.korailSearchInst.$el.hide()},showDerails:function(){this.data.derailSearchInst&&this.data.derailSearchInst.$el&&this.data.derailSearchInst.$el.show()},hideDerails:function(){this.data.derailSearchInst&&this.data.derailSearchInst.$el&&this.data.derailSearchInst.$el.hide()},showTrains:function(){this.ui.TrainForm&&this.ui.TrainForm.show()},hideTrains:function(){this.ui.TrainForm&&this.ui.TrainForm.hide()},initEurorailSearch:function(t){var i=this.options.searchBoxParamObj,e=i.eurorail||{},a=i.korail||{},r=i.derail||{},n=i.jprail||{};this.options.hasEurorail&&(this.data.eurorailSearchInst=new t({searchParams:{DepartureCity:e.DepartureCity||"",ArrivalCity:e.ArrivalCity||"",DepartureCityCode:e.DepartureCityCode||"",ArrivalCityCode:e.ArrivalCityCode||"",DepartDate:e.DepartDate||null,hidAdultNum:e.hidAdultNum||1,hidChildNum:e.hidChildNum||0,hidYoungNum:e.hidYoungNum||0,hidOldNum:e.hidOldNum||0},config:{calendarMinDate:0,calendarMaxDate:180}}).init(),this.data.eurorailSearchInst.$el.insertAfter(this.ui.TrainForm)),this.options.hasKorail&&this.initKorailSearch(t,a),this.options.hasDerail&&this.initDerailSearch(t,r),this.options.hasJprail&&this.initJpRailSearch(t,n)},initJpRailSearch:function(t,i){this.data.jprailSearchInst=new t({trainType:"jp",searchParams:{DepartureCity:i.DepartureCity||"",ArrivalCity:i.ArrivalCity||"",DepartureCityCode:i.DepartureCityCode||"",ArrivalCityCode:i.ArrivalCityCode||"",DepartDate:i.DepartDate||null,SeatPreference:i.SeatPreference||r.locals.key_japanrail_free_seat,hidAdultNum:i.hidAdultNum||1,hidChildNum:i.hidChildNum||0,hidYoungNum:i.hidYoungNum||0,hidOldNum:i.hidOldNum||0},seatEnum:{1:r.locals.key_japanrail_free_seat,2:r.locals.key_japanrail_fixed_seat,3:r.locals.key_japanrail_green_seat},hourRange:{startHour:0,endHour:23,gap:1},minuteRange:{startMinute:0,endMinute:59,gap:5},defaultSelectedHourText:"06",defaultSelectedMinuteText:"00",maxPassengerNum:5,paramsStoreKey:"_jprail_s_param",hasTitle:!1,addrJSONPUrl:"/japanrail/address/GetTrainLocation?keyword=${unescape(key)}",suggestionUrl:"/japanrail/address/GetHotTrainLocation",listUrl:"/japanrail/list",template:{body:'<form action="${listUrl}" class="mod-con-eu" method="get" id="EurorainForm"><ul class="search-items clearfix"><li class="s-item s-item-l"><label for="">${i18n.LabelText_UpperFrom} </label><input class="c-ipt ipt-borderless" type="text" name="DepartureCity" placeholder="${i18n.V2_Trains_List_Label_Filter_DepartureStation}" id="DepartureCity" /></li><li class="dir-switch"><a href="javascript:;"><i class="c-icon icon-dir-switch"></i></a></li><li class="s-item s-item-r"><label for="">${i18n.LabelText_UpperTo}</label><input class="c-ipt ipt-borderless" type="text" name="ArrivalCity" id="ArrivalCity" placeholder="${i18n.V2_Trains_List_Label_Filter_ArrivalStation}" /></li><li class="s-item s-item-l"><label for="">${i18n.Home_LabelText_Depart}</label><div class=""><input class="c-ipt date" style="width: 36%;" type="text"  id="DepartDate" readonly="readonly" /><div class="c-sel-time"><div class="_time"><span>06</span><div class="triangle"></div></div><ul class="c-time-list" data-type="DepartHourIpt"><li>00</li><li>01</li><li>02</li><li>03</li><li>04</li><li>05</li><li>06</li><li>07</li><li>08</li><li>09</li><li>10</li><li>11</li><li>12</li><li>13</li><li>14</li><li>15</li><li>16</li><li>17</li><li>18</li><li>19</li><li>20</li><li>21</li><li>22</li><li>23</li></ul></div><div class="c-sel-time" style="margin-left: 2%;"><div class="_time"><span>00</span><div class="triangle"></div></div><ul class="c-time-list" data-type="DepartMinuteIpt"><li>00</li><li>05</li><li>10</li><li>15</li><li>20</li><li>25</li><li>30</li><li>35</li><li>40</li><li>45</li><li>50</li><li>55</li><li>59</li></ul></div></div></li><li class="s-item s-item-r"><label for="" style="position: relative; overflow: visible;"><span class="seat-preference-info" style="cursor: pointer;">'+r.locals.key_japanrail_seat_pre+' <b style="color: #2681FF; font-size: 10px; border: 1px solid #2681FF; border-radius: 50%; padding: 2px; display: inline-block; width: 5px; height: 5px; line-height: 9px; text-align: center;">i</b></span><div class="what-is-seat-preference" style="display: none; color: #333; position: absolute; top: 20px; width: 100%; background: #fff; border: 1px solid #999; padding: 10px 25px; z-index: 999;"><div class="title" style="font-weight: 700; text-align: center; font-size: 16px;">'+r.locals.key_jp_what_is_pre_seat+'</div><div class="des" style="margin: 10px 0 18px;">'+r.locals.key_jp_pre_seat_desc+'</div></div></label><style>.m-ms-train .mod-con-eu .s-item .passenger.active .passenger-no i {background-position: -90px -157px!important;}</style><div class="c-ipt passenger"><div class="passenger-no"><span>'+r.locals.key_japanrail_free_seat+'</span><i style="float: right; margin-right: 6px; font-size: 10px; width: 14px; background-position: -117px -157px;"></i></div><ul class="passenger-no-list japanrail kor"><li data-seat-index="1" data-seat-val="JP_FREE">'+r.locals.key_japanrail_free_seat+'</li><li data-seat-index="2" data-seat-val="JP_DESIGNATED">'+r.locals.key_japanrail_fixed_seat+'</li><li data-seat-index="3" data-seat-val="JP_GREEN">'+r.locals.key_japanrail_green_seat+'</li></ul></div><input class="c-ipt ipt-gray" type="text" name="TrainNo" id="TrainNo" style="display: none; "/></li></ul><div class="search-btn" style="margin-top: 10px;"><button class="c-btn btn-key btn-xl btn-book-avalible" id="SearchSubmit">${i18n.V2_Trains_Search_Button_Search}</button></div><input id="DepartureCityCode" type="hidden" name="DepartureCityCode"/><input id="ArrivalCityCode" type="hidden" name="ArrivalCityCode"/><input id="DepartureStation" type="hidden" name="DepartureStation"/><input id="ArrivalStation" type="hidden" name="ArrivalStation"/><input id="HidDepartDate" type="hidden" name="DepartDate"/><input id="DepartHourIpt" type="hidden" name="DepartHourIpt" value="06"/><input id="DepartMinuteIpt" type="hidden" name="DepartMinuteIpt" value="00"/><input id="SeatPreference" type="hidden" name="SeatPreference" value="JP_FREE" /></form>'
},config:{calendarMinDate:0,calendarMaxDate:365}}).init(!0),this.data.jprailSearchInst.$el.insertAfter(this.ui.TrainForm)},initKorailSearch:function(t,i){this.data.korailSearchInst=new t({searchParams:{DepartureCity:i.DepartureCity||"",ArrivalCity:i.ArrivalCity||"",DepartureCityCode:i.DepartureCityCode||"",ArrivalCityCode:i.ArrivalCityCode||"",DepartDate:i.DepartDate||null,hidAdultNum:i.hidAdultNum||1,hidChildNum:i.hidChildNum||0,hidYoungNum:i.hidYoungNum||0,hidOldNum:i.hidOldNum||0},paramsStoreKey:"_korail_s_param",hasTitle:!1,addrJSONPUrl:"/korail/address/GetTrainLocation?keyword=${unescape(key)}",suggestionUrl:"/korail/address/GetHotTrainLocation",listUrl:"/korail/list",template:{body:'<form action="${listUrl}" class="mod-con-eu" method="get" id="EurorainForm"><ul class="search-items clearfix"><li class="s-item s-item-l"><label for="">${i18n.LabelText_UpperFrom} </label><input class="c-ipt ipt-borderless" type="text" name="DepartureCity" placeholder="${i18n.V2_Trains_List_Label_Filter_DepartureStation}" id="DepartureCity" /></li><li class="dir-switch"><a href="javascript:;"><i class="c-icon icon-dir-switch"></i></a></li><li class="s-item s-item-r"><label for="">${i18n.LabelText_UpperTo}</label><input class="c-ipt ipt-borderless" type="text" name="ArrivalCity" id="ArrivalCity" placeholder="${i18n.V2_Trains_List_Label_Filter_ArrivalStation}" /></li><li class="s-item s-item-l"><label for="">${i18n.Home_LabelText_Depart}</label><div class=""><input class="c-ipt date" type="text"  id="DepartDate" readonly="readonly" /><div class="c-sel-time"><div class="_time"><span>06:00</span><div class="triangle"></div></div><ul class="c-time-list"><li>00:00</li><li>01:00</li><li>02:00</li><li>03:00</li><li>04:00</li><li>05:00</li><li>06:00</li><li>07:00</li><li>08:00</li><li>09:00</li><li>10:00</li><li>11:00</li><li>12:00</li><li>13:00</li><li>14:00</li><li>15:00</li><li>16:00</li><li>17:00</li><li>18:00</li><li>19:00</li><li>20:00</li><li>21:00</li><li>22:00</li><li>23:00</li></ul></div></div></li><li class="s-item s-item-r"><label for="">${i18n.Passengers}</label><div class="c-ipt passenger"><div class="passenger-no"><span>1</span><i></i></div><ul class="passenger-no-list kor"><li>${i18n.key_korail_searchbox_adult} (${i18n.key_korail_searchbox_adult_age})<div><i class="disable">-</i><span>1</span><i class="disable">+</i></div></li><li>${i18n.key_korail_searchbox_child} (${i18n.key_korail_searchbox_child_age}) <div><i>-</i><span>0</span><i>+</i></div> </li><li><span>${i18n.key_korail_searchbox_warning}</span></li></ul></div><input class="c-ipt ipt-gray" type="text" name="TrainNo" id="TrainNo" style="display: none; "/></li></ul><div class="search-btn" style="margin-top: 25px;"><button class="c-btn btn-key btn-xl btn-book-avalible" id="SearchSubmit">${i18n.V2_Trains_Search_Button_Search}</button></div><input id="DepartureCityCode" type="hidden" name="DepartureCityCode"/><input id="ArrivalCityCode" type="hidden" name="ArrivalCityCode"/><input id="DepartureStation" type="hidden" name="DepartureStation"/><input id="ArrivalStation" type="hidden" name="ArrivalStation"/><input id="HidDepartDate" type="hidden" name="DepartDate"/><input id="DepartHourIpt" type="hidden" name="DepartHourIpt" value="06:00"/><input id="hidAdultNum" type="hidden" name="hidAdultNum" /><input id="hidChildNum" type="hidden" name="hidChildNum" /><input id="hidYoungNum" type="hidden" name="hidYoungNum" /><input id="hidOldNum" type="hidden" name="hidOldNum" /></form>'},config:{calendarMinDate:0,calendarMaxDate:30}}).init(),this.data.korailSearchInst.$el.insertAfter(this.ui.TrainForm)},initDerailSearch:function(t,i){this.data.derailSearchInst=new t({searchParams:{DepartureCity:i.DepartureCity||"",ArrivalCity:i.ArrivalCity||"",DepartureCityCode:i.DepartureCityCode||"",ArrivalCityCode:i.ArrivalCityCode||"",DepartDate:i.DepartDate||null,hidAdultNum:i.hidAdultNum||1,hidChildNum:i.hidChildNum||0,hidYoungNum:i.hidYoungNum||0,hidOldNum:i.hidOldNum||0},maxPassengerNum:5,paramsStoreKey:"_derail_s_param",hasTitle:!1,addrJSONPUrl:"/deutsche-bahn/address/GetTrainLocation?keyword=${unescape(key)}",suggestionUrl:"/deutsche-bahn/address/GetHotTrainLocation",listUrl:"/deutsche-bahn/list",template:{body:'<form action="${listUrl}" class="mod-con-eu" method="get" id="EurorainForm"><ul class="search-items clearfix"><li class="s-item s-item-l"><label for="">${i18n.LabelText_UpperFrom} </label><input class="c-ipt ipt-borderless" type="text" name="DepartureCity" placeholder="${i18n.V2_Trains_List_Label_Filter_DepartureStation}" id="DepartureCity" /></li><li class="dir-switch"><a href="javascript:;"><i class="c-icon icon-dir-switch"></i></a></li><li class="s-item s-item-r"><label for="">${i18n.LabelText_UpperTo}</label><input class="c-ipt ipt-borderless" type="text" name="ArrivalCity" id="ArrivalCity" placeholder="${i18n.V2_Trains_List_Label_Filter_ArrivalStation}" /></li><li class="s-item s-item-l"><label for="">${i18n.Home_LabelText_Depart}</label><div class=""><input class="c-ipt date" type="text"  id="DepartDate" readonly="readonly" /><div class="c-sel-time"><div class="_time"><span>06:00</span><div class="triangle"></div></div><ul class="c-time-list"><li>00:00</li><li>01:00</li><li>02:00</li><li>03:00</li><li>04:00</li><li>05:00</li><li>06:00</li><li>07:00</li><li>08:00</li><li>09:00</li><li>10:00</li><li>11:00</li><li>12:00</li><li>13:00</li><li>14:00</li><li>15:00</li><li>16:00</li><li>17:00</li><li>18:00</li><li>19:00</li><li>20:00</li><li>21:00</li><li>22:00</li><li>23:00</li></ul></div></div></li><li class="s-item s-item-r"><label for="">${i18n.Passengers}</label><div class="c-ipt passenger"><div class="passenger-no"><span>1</span><i></i></div><ul class="passenger-no-list kor"><li>${i18n.key_derail_searchbox_adult}(${i18n.key_derail_searchbox_adult_age}) <div><i class="disable">-</i><span>1</span><i class="disable">+</i></div></li><li>${i18n.key_derail_searchbox_child}(${i18n.key_derail_searchbox_child_age})<div><i>-</i><span>0</span><i>+</i></div> </li><li><span>${i18n.key_derail_searchbox_mention_1}</span><br><span>${i18n.key_derail_searchbox_mention_2}</span></li></ul></div><input class="c-ipt ipt-gray" type="text" name="TrainNo" id="TrainNo" style="display: none; "/></li></ul><div class="search-btn" style="margin-top: 25px;"><button class="c-btn btn-key btn-xl btn-book-avalible" id="SearchSubmit">${i18n.V2_Trains_Search_Button_Search}</button></div><input id="DepartureCityCode" type="hidden" name="DepartureCityCode"/><input id="ArrivalCityCode" type="hidden" name="ArrivalCityCode"/><input id="DepartureStation" type="hidden" name="DepartureStation"/><input id="ArrivalStation" type="hidden" name="ArrivalStation"/><input id="HidDepartDate" type="hidden" name="DepartDate"/><input id="DepartHourIpt" type="hidden" name="DepartHourIpt" value="06:00"/><input id="hidAdultNum" type="hidden" name="hidAdultNum" /><input id="hidChildNum" type="hidden" name="hidChildNum" /><input id="hidYoungNum" type="hidden" name="hidYoungNum" /><input id="hidOldNum" type="hidden" name="hidOldNum" /></form>'},config:{calendarMinDate:0,calendarMaxDate:180}}).init(),this.data.derailSearchInst.$el.insertAfter(this.ui.TrainForm)},getElements:function(){var t=this.options.css;this.ui.TrainForm=this.$el.find(t.TrainForm),this.ui.DepartureCity=this.ui.TrainForm.find(t.DepartureCity),this.ui.DepartureStation=this.ui.TrainForm.find(t.DepartureStation),this.ui.DepartureCityPinyin=this.ui.TrainForm.find(t.DepartureCityPinyin),this.ui.ArrivalCity=this.ui.TrainForm.find(t.ArrivalCity),this.ui.ArrivalStation=this.ui.TrainForm.find(t.ArrivalStation),this.ui.ArrivalCityPinyin=this.ui.TrainForm.find(t.ArrivalCityPinyin),this.ui.DepartDate=this.ui.TrainForm.find(t.DepartDate),this.ui.HidDepartDate=this.ui.TrainForm.find(t.HidDepartDate),this.ui.TrainNo=this.ui.TrainForm.find(t.TrainNo),this.ui.SearchSubmit=this.ui.TrainForm.find(t.SearchSubmit),this.ui.SearchBoxArg=this.ui.TrainForm.find(t.SearchBoxArg),this.ui.SwitchDirIcon=this.ui.TrainForm.find(t.SwitchDirIcon)},render:function(){return this.createEl(t.tmpl.render(this.options.template.body,{hasTitle:this.options.hasTitle,channel:this.options.channel,i18n:this.options.i18n.locals}))},createEl:function(i){var e=t(document.createElement("div"));return e.html(i),e.children()},initAddressInputs:function(){var t=this.options.i18n.locals,i={inputEmpty:t.Alert_ProvideDepCityName,sameInputValue:t.same_city,suggestionTitle:t.Top_Destinations,suggestionTip:t.Side_Tipname},e=this.options.addrJSONPUrl;this._insFromAddr=new o(this.ui.DepartureCity,{css:{elName:this.ui.DepartureCity.attr("name"),relate:this.ui.DepartureStation},i18n:i,tmpl:s.template,suggestionSource:this.options.i18n.data.suggestion1,jsonpFilter:e}),this._insToAddr=new o(this.ui.ArrivalCity,{css:{elName:this.ui.ArrivalCity.attr("name"),relate:this.ui.ArrivalStation},i18n:{inputEmpty:t.Alert_ProvideArrCityName,sameInputValue:t.same_city,suggestionTitle:t.Top_Destinations,suggestionTip:t.Side_Tipname},tmpl:s.template,suggestionSource:this.options.i18n.data.suggestion1,jsonpFilter:e,listeners:{onChange:function(t,i){}}})},initCalendar:function(){var e=t.storage.get("_main_trains_sb_sd"),a=i.createDate(),r=a,n=r.addDays(this.options.config.calendarMaxDate),s=r;s=e&&e.DepartDate&&i.isBefore(r,e.DepartDate)?i.toCNDateFormat(e.DepartDate):i.toCNDateFormat(s),this._instDepartDate=new l(this.ui.DepartDate,{options:{minDate:r,maxDate:n,relate:[this.ui.HidDepartDate],relateDisplay:null,defaultDate:s},listeners:{onChange:function(t,i,e,a,r,n,s){}}})},isActive:function(){return"block"===this.$el.css("display")},searchBefore:function(t){if(this.options.hook&&this.options.hook.search&&"function"==typeof this.options.hook.search)try{t.name="trains",this.options.hook.search(t)}catch(i){throw new Error(i)}},show:function(){this.$el&&this.$el.show()},hide:function(){this.$el&&this.$el.hide()},checkFormIsAvilable:function(){return this._insFromAddr.checkIsAvilable()&&this._insToAddr.checkIsAvilable(this._insFromAddr.getInputValue())?(this._saveSearchForm(),!0):void 0},_saveSearchForm:function(){for(var i=0,e=this._initFieldsArr.length,a={};e>i;i++)if(this.ui[this._initFieldsArr[i]])try{a[this._initFieldsArr[i]]=this.ui[this._initFieldsArr[i]].value()}catch(r){throw new Error(r)}a.DepartDate=this.ui.HidDepartDate.value(),t.storage.set("_main_trains_sb_sd",a)},_initFieldsArr:["DepartureCity","ArrivalCity","TrainNo","DepartureCityPinyin","ArrivalCityPinyin","DepartureStation","ArrivalStation"],_initSearchForm:function(){var i=0,e=this._initFieldsArr.length,a=this.options.data,r=t.storage.get("_main_trains_sb_sd");if(r)for(;e>i;i++)if(this.ui[this._initFieldsArr[i]])try{r[this._initFieldsArr[i]]&&this.ui[this._initFieldsArr[i]].value(r[this._initFieldsArr[i]])}catch(n){throw new Error(n)}t.trim(this.ui.ArrivalCity.value())||(this.ui.ArrivalCity.value(a.ArrivalCity),this.ui.ArrivalStation.value(a.ArrivalStation)),t.trim(this.ui.DepartureCity.value())||(this.ui.DepartureCity.value(a.DepartureCity),this.ui.DepartureStation.value(a.DepartureStation))},updateHidDepartDate:function(t){t&&this.ui.HidDepartDate.value(t)},switchDir:function(){var t=this.ui.DepartureCity.value(),i=this.ui.DepartureStation.value();this.ui.DepartureCity.value(this.ui.ArrivalCity.value()),this.ui.DepartureStation.value(this.ui.ArrivalStation.value()),this.ui.ArrivalStation.value(i),this.ui.ArrivalCity.value(t)},bindEvents:function(){var i=this;this.ui.SearchSubmit.on("click",function(e){e.preventDefault(),i.checkFormIsAvilable()&&("undefined"!=typeof IBU&&IBU.ui.PopLoading&&IBU.ui.PopLoading.getInstance().show(),i.searchBefore(t.storage.get("_main_trains_sb_sd")),t(this).css("cursor","wait"),i.ui.TrainForm.submit())}),this.ui.SwitchDirIcon.length&&this.ui.SwitchDirIcon.bind("click",function(){i.switchDir()})}},d}),require(["cQueryPro","common/search_box","common/utils","importNotes","common/trains_search_v2"],function(t,i,e,a,r){function n(t){return __SITE_CONFIG__.initFunc.getParam(t)}cQuery.ajax("/trains/Home/GetTrainsInfo?lang="+__PAGE_CONFIG__.base.LanguageCode,{method:"GET",async:!0,onsuccess:function(i){var a=t("#TopTrains"),r=t("#TopTrainsMore");a.html(i.responseText),i.responseText?(r.show(),new e.TabMini(a,{css:{item:".tab",active:"active"},itemUpdateCallback:function(t,i){this.$el.find(".tab-cnt").removeClass("active").eq(i).addClass("active"),r.find("a").attr("href","/trains/schedule/"+t.data("name")+"/")}})):r.hide()},onerror:function(t){}});var s=requirejs.utils.getI18n(),o=requirejs.utils.getPageConfig(),l=(o.base||{},__SITE_CONFIG__||{});a.init({globalEnv:o.URLConfig.globalEnv,LanguageCode:l.page.language,SiteCode:l.page.site});var d=/start=eurotrains/i.test(location.hash)||/UK/i.test(n("tab")),u=/start=korail/i.test(location.hash)||/Korea/i.test(n("tab")),c=/start=derail/i.test(location.hash)||/Deutsche/i.test(n("tab")),h=/start=japanrail/i.test(location.hash)||/Japan/i.test(n("tab")),p=0,f={},m=1,v={},y=n("DepartureCity"),g=n("ArrivalCity"),b=y&&g?{DepartureCity:y,ArrivalCity:g,DepartureCityCode:n("DepartureCityCode"),ArrivalCityCode:n("ArrivalCityCode"),DepartDate:n("DepartDate"),DepartHourIpt:n("DepartHourIpt"),hidAdultNum:n("hidAdultNum"),hidChildNum:n("hidChildNum"),hidYoungNum:n("hidYoungNum"),hidOldNum:n("hidOldNum")}:null;Train_Page_Config.isShowEuroTab&&(f.eurorail=m++),Train_Page_Config.isShowKoTab&&(f.korail=m++),Train_Page_Config.isShowDeTab&&(f.derail=m++),Train_Page_Config.isShowJpTab&&(f.jprail=m++),d?(p=f.eurorail||0,v.eurorail=b):u?(p=f.korail||0,v.korail=b):c?(p=f.derail||0,v.derail=b):h&&(p=f.jprail||0,v.jprail=b);var D=new r({channel:"index",hasTitle:1==Train_Page_Config.isShowEuroTab?!1:!0,tabIndex:p,hasEurorail:1==Train_Page_Config.isShowEuroTab?!0:!1,hasKorail:1==Train_Page_Config.isShowKoTab?!0:!1,hasDerail:1==Train_Page_Config.isShowDeTab?!0:!1,hasJprail:1==Train_Page_Config.isShowJpTab?!0:!1,searchBoxParamObj:v});D.init(),t(".mod-main-search").replaceWith(D.$el),new i.SearchTrainSchedule(t("#SearchTrainSchedule")).init(),new i.GetTrainDeals(t("#GetDealsByEmail"),{i18n:s}).init(),new e.ScrollBar(t(".mod-back-top"));var _="//pic.english.c-ctrip.com/common_v3/star-on.png",C="//pic.english.c-ctrip.com/common_v3/star-off.png",S=function(i,e){var a={css:{Rating:"appRating",RatingStar:"#appRatingStar",Star:"#appRatingStar img",PopRate:"#pop-rate",PopRateTitle:"#pop-h2-title",PopRateCloseButton:"#pop-close-btn",PopRateCloseButtonMini:"#pop-close-btn-mini"},config:{DefaultStar:4}};this.el=i,this.opts=t.extend(a,e),this.ui={},this.instances={}};S.prototype={constructor:S,init:function(){this._initEl(),this._initComponents(),this._bindEvent()},_initEl:function(){var t=this.opts.css;this.ui.Rating=this.el.find(t.Rating),this.ui.RatingStar=this.el.find(t.RatingStar),this.ui.Star=this.el.find(t.Star),this.ui.PopRate=this.el.find(t.PopRate),this.ui.PopRateTitle=this.el.find(t.PopRateTitle),this.ui.PopRateCloseButton=this.el.find(t.PopRateCloseButton),this.ui.PopRateCloseButtonMini=this.el.find(t.PopRateCloseButtonMini)},_initComponents:function(){this.opts.css,this.opts.config},HideRateBox:function(t){this.opts.css,this.opts.config;this.ui.PopRate.hide()},ShowRateBox:function(t){this.opts.css,this.opts.config;0==t?this.ui.PopRateTitle.html(__I18N__.ratingMessageSuccess):this.ui.PopRateTitle.html(__I18N__.ratingMessageFailed),this.ui.PopRate.show()},InitStars:function(t){for(var i=(this.opts.css,this.opts.config),e=0;e<i.DefaultStar;e++)this.ui.Star.eq(e).attr("src",_);for(;e<this.ui.Star.length;e++)this.ui.Star.eq(e).attr("src",C)},UpdateStars:function(t){for(var i=(this.opts.css,this.opts.config,0);i<this.ui.Star.length&&(this.ui.Star.eq(i).attr("src",_),this.ui.Star[i]!=t.target);i++);for(i++;i<this.ui.Star.length;i++)this.ui.Star.eq(i).attr("src",C)},Rate:function(i){var e="/trains/rate/";if(1==t.storage.get("_tr_rate"))return void this.ShowRateBox(1);for(var a=0;a<this.ui.Star.length&&(this.ui.Star.eq(a).attr("src",_),this.ui.Star[a]!=i.target);a++);a++,e+=a,t.ajax(e,{method:"GET",escape:!1,async:!0,cache:!0,onsuccess:function(t){},onerror:function(t){},onabort:function(t){}}),t.storage.set("_tr_rate",1),this.ShowRateBox(0)},_bindEvent:function(){var t=this;this.opts.css;this.ui.Star.on("mouseover",function(i){t.UpdateStars(i)}),this.ui.Star.on("mouseout",function(i){t.InitStars(i)}),this.ui.Star.on("click",function(i){t.Rate(i)}),this.ui.PopRateCloseButton.on("click",function(i){t.HideRateBox(i)}),this.ui.PopRateCloseButtonMini.on("click",function(i){t.HideRateBox(i)})}},new S(t(".mod-rate-page"),{config:{DefaultStar:Math.round(t("#appRatingValue").html())},i18n:s}).init()}),define("index",function(){});