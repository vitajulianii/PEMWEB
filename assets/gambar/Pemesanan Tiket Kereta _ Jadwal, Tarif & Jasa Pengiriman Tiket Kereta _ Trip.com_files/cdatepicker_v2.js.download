!function(_){function e(t){this._config=_.extend(!0,{scrollBody:null,scrollTarget:null,gap:{top:0,bottom:0},animSpeed:20},t),this.init()}window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},e.prototype={constructor:e,init:function(){this._config.scrollTarget||(this._config.scrollTarget=this._config.target),this._config.scrollBody&&!cQuery.isCDom(this._config.scrollBody)&&(this._config.scrollBody=cQuery(this._config.scrollBody)),cQuery.isCDom(this._config.scrollTarget)||(this._config.scrollTarget=cQuery(this._config.scrollTarget));var t=navigator.appVersion.match(/chrome\/(\d+)/i),e=0;t&&2<=t.length&&(e=parseInt(t[1])),this.ui={body:(cQuery.isCDom(this._config.scrollBody)?this._config.scrollBody[0]:this._config.scrollBody)||(cQuery.browser.isChrome&&e<60?document.body:document.documentElement)}},_findFirstBlock:function(t){var i=null;return cQuery.each(t,function(t,e){"style"!==e.nodeName.toLowerCase()&&(i=e)}),i},getScrollTop:function(){return this.getBodyClientHeight()+this.getBodyScrollTop()},getBodyScrollTop:function(){return this.ui.body.scrollTop},setBodyScrollTop:function(t){t&&(this.ui.body.scrollTop=t)},getBodyClientHeight:function(){return this.ui.body.clientHeight},getBodyScrollHeigth:function(){return this.ui.body.scrollHeight},scrollTop:function(t){t&&(this.ui.body.scrollTop=t)},canScroll:function(){return this.getBodyScrollHeigth()!==this.getBodyClientHeight()},_checkScroll:function(t){if(this.canScroll()&&t){var e=this._findFirstBlock(t[0].children);if(e){var i=cQuery(e).offset(),a=i.top+i.height+this._config.gap.bottom,n=a-this.getBodyClientHeight(),s=this._config.scrollTarget.offset(),o=Math.min(n,s.top-this._config.gap.top);this.getScrollTop()<a&&this.startAnim(this.getBodyScrollTop(),o)}}},checkScroll:function(t){setTimeout(function(){this._checkScroll(t)}.bind(this),0)},_requestId:null,startAnim:function(t,e){this.animInfo={begin:t,end:e,range:e-t,startNum:0,endNum:this._config.animSpeed||20},this.animation()},animation:function(){var t=this;this._requestId=requestAnimationFrame(function(){t.setBodyScrollTop(t.animInfo.begin+t.animInfo.startNum/t.animInfo.endNum*t.animInfo.range),t.animInfo.startNum<t.animInfo.endNum&&(t.animInfo.startNum+=1,t.animation())})},cancelAnim:function(){this._requestId&&(cancelAnimationFrame(this._requestId),this.setBodyScrollTop(this.animInfo.end))}};var n=/YYYY(-|\/)MM(-|\/)DD/i,s=/\d{4}(-|\/)\d{2}(-|\/)\d{2}/i,o=/DD(-|\/)MM(-|\/)YYYY/i,r=/\d{2}(-|\/)\d{2}(-|\/)\d{4}/i,g={_cache_:{},VERSION:"1.0.2",DKEY:"yyyy-mm",MASK:"yyyy-mm-dd",log:function(t){if(g._cache_.logs||(g._cache_.logs=[]),!t)return g._cache_.logs;g._cache_.logs.push(t)},pad:function(t,e){for(t+="",e=e||2;t.length<e;)t="0"+t;return t},format:function(t,e){e=e||this.MASK,t.getDate||(t=new Date(t));var i=t.getDate(),a=g.pad,n=(t.getDay(),t.getMonth()),s=t.getFullYear(),o=t.getHours(),r=t.getMinutes(),l=t.getSeconds(),d=t.getTime(),h={d:i,dd:a(i),m:n+1,mm:a(n+1),yy:String(s).slice(2),yyyy:s,H:o,M:r,S:l,L:a(d,3)};return e.replace(/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|"[^"]*"|'[^']*'/g,function(t){return t in h?h[t]:t.slice(1,t.length-1)})},parseDateInt:function(t){return"string"==typeof t&&(t=g.createDate(t)),!!t&&parseInt(g.format(t,"yyyymmdd"),10)},addMonth:function(t,e){return new Date(t.getFullYear(),t.getMonth()+e,1)},get:function(t){if(!t)return g.log("Date is null, Can't create calendar data structure."),null;var e=g.format(t,"yyyy-mm");return g._cache_[e]||g._create(t,e),g._cache_[e]},daysOfDate:function(t,e){if(window.CIDate&&window.CIDate.daysOfDate)return window.CIDate.daysOfDate(t,e)},_create:function(t,e){for(var i=t.getFullYear(),a=t.getMonth(),n=(t.getDay(),t.getDate(),new Date(i,a,1).getDay()-1),s=(new Date(i,a+1,0).getDate(),[]),o=0;o<42;o++){var r=new Date(i,a,o-n),l=g.format(r,"yyyy-mm-dd"),d={o:r,k:l,i:parseInt(l.replace(/-/gi,""),10),y:r.getFullYear(),m:r.getMonth(),d:r.getDate(),w:r.getDay()};s.push(d)}return g._cache_[e]=s},createDate:function(t,e){if(e=e||"YYYY-MM-DD",(i=t)instanceof Date||"[object Date]"===Object.prototype.toString.call(i))return t;var i,a=new Date;return s.test(t)&&n.test(e)?(a.setMonth(0),a.setFullYear(parseInt(t.slice(0,4),10)),a.setDate(parseInt(t.slice(8,10),10)),a.setMonth(parseInt(t.slice(5,7),10)-1)):r.test(t)&&o.test(e)?(a.setMonth(0),a.setFullYear(parseInt(t.slice(6,10),10)),a.setDate(parseInt(t.slice(0,2),10)),a.setMonth(parseInt(t.slice(3,5),10)-1)):r.test(t)?(a.setMonth(0),a.setFullYear(parseInt(t.slice(6,10),10)),a.setDate(parseInt(t.slice(3,5),10)),a.setMonth(parseInt(t.slice(0,2),10)-1)):t&&"Invalid Date"===(a=new Date(t)).toString()&&(a=new Date),a}},d=new Date,m=null,h="en-US";if(window.__HEAD_CONFIG__&&window.__HEAD_CONFIG__.locale){var t=__HEAD_CONFIG__.locale.match(/(\S+)_(\S+)/);2<t.length&&(h=t[1]+"-"+t[2].toUpperCase())}var a=function(t,e){var i="所有日期以當地時間作準",a={EN:"All dates are in local time",JP:"全ての日程は現地時間です",KR:"날짜는 현지시각 기준입니다",HK:i,DE:"Datum wird in der lokalen Zeit angezeigt",ES:"Todas las fechas aparecen en la hora local",FR:"Toutes les dates sont exprimées en heures locales",RU:"Все даты указаны по местному времени",ID:"Semua tanggal pada waktu lokal",TH:"ทุกวันเป็นเวลาท้องถิ่น",MY:"Semua tarikh dalam waktu tempatan",TW:i};this.data={},this.ui={},this.setting={options:{container:document.body,prevInput:null,step:2,offset:{top:1},minDate:"#",maxDate:null,startDate:null,endDate:null,permit:null,prohibit:null,weekday:"0123456",render:"default",showAlways:!1,showOptions:!1,showWeek:!1,showLimits:!1,focusNext:!0,nextInput:null,nextInputRelate:null,nextInterval:0,relate:"",relateDisplay:"",defaultDate:null,date:null,CNDateFormat:"yyyy-mm-dd",serverDateFormat:"mm-dd-yyyy",displayDateFormat:"mdeShortString",displayShortYearFormat:"ymShortString",displayShortMonthFormat:"mdShortString",zindex:9999,displayRangeDate:!0,hasCloseBtn:!1,hideWaiting:0,festivalHasDateTime:!0,scrollTarget:t,festivalDisplayLength:3,scrollGap:{top:0,bottom:10},scrollAnimatingSpeed:20,initDefaultDate:!0},string:{input:"",header:"请选择日期",title:"yyyy年m月",week:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekText:["pic_sun","pic_mon","pic_tue","pic_wed","pic_thu","pic_fir","pic_sat"],todayText:["pic_today","pic_tomorrow","pic_aftertomorrow"],localTime:a,rangeDateText:"${startDateText} - ${endDateText} ( ${rangeNum} nights )"},base:window.__HEAD_CONFIG__||{channel:"home",group:"trip",currency:"USD",language:"EN",site:"EN",locale:"en_us"},locales:{calendar:window.__SITE_CONFIG__&&window.__SITE_CONFIG__.calendar||{Holidays:[],Months:"January_February_March_April_May_June_July_August_September_October_November_December",ShortMonths:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec",ShortWeeks:"Sun_Mon_Tue_Wed_Thu_Fri_Sat",Weeks:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday"}},colours:{"default":{saturday:"weekend-sa",sunday:"weekend-su",festival:"festival"}},weekStart:{"default":0,RU:1},dateTimeFormat:function(t,e){return{MMdd:!0,MMddww:!0,cyyyyMM:!0,hmm:!0,yyyyMMdd:!0,yyyyMMddhmm:!0,yyyyMMddww:!0}[e]&&(e="mdeShortString"),window.l10n.DateTimeFormat(h)[e](t)},classNames:{select:"active",range:"interval",nothismonth:"past-date",blankdate:"day_no",today:"today",saturday:"",sunday:"sunday",disabled:"disabled",tomorrow:"",aftertomorrow:"",festival:"c_festival_select"},listeners:{onBeforeShow:null,onShow:null,onChange:null},template:{wrapper:'<div class="m-cld mod-calender {{if single}}cld-single {{/if}}{{if currency}}cld-price {{/if}}"><div class="cld-hd clearfix"><span class="arrow" id="${uarrowid}"></span><div class="month-hd clearfix"><span class="arrow-box" data-bind="prev" id="prev-month"><i data-bind="prev" class="prev-btn"></i></span><div class="month-label month-label-1st" id="${um1id}"><span class="month">May</span> <span class="year">2016</span> </div> <div class="month-label month-label-2nd" id="${um2id}"><span class="month">Jun</span> <span class="year">2016</span> </div> <span class="arrow-box arrow-box-next" data-bind="next" id="next-month"><i data-bind="next" class="next-btn"></i></span></div><ul class="week-hd week-hd-1st" id="${uw1id}"></ul><ul class="week-hd week-hd-2nd" id="${uw2id}"></ul></div><div class="cld-bd clearfix" id="${uid}"></div><div class="cld-bd clearfix"><div class="hr"></div></div><div class="cld-ft clearfix"><ul class="local-list clearfix">{{if displayRangeDate}}<li class="local-list-date-range" id="date-range-text">Mon, Jun 11 - Tue, Jun 14 ( 3 nights )</li>{{/if}}<li>${localTime}</li></ul>{{if hasCloseBtn}}<span class="close-btn" data-bind="close"><i class="fi fi-close" data-bind="close"></i></span>{{/if}}{{if currency}}<div class="currency">${currency}</div>{{/if}}</div></div>',calendar:'<div class="month-con ${monthclass}"><table class="date-tbl {{if hasPriceList}} date-price {{/if}}"><tbody>{{each(index) data}}{{if index%7 == 0}}<tr>{{/if}}{{if day}}<td ${attr}><div class="cell ${classes}" ${attr}>${day}{{if hasPriceList}}<div class="price" ${attr}>${price}&nbsp;</div>{{/if}}{{if isfestival}}<span class="festival-dot" ${attr}></span>{{/if}}</div></td> {{else}} <td></td> {{/if}}{{if (index + 8)%7 == 0}}</tr>{{/if}}{{/each}}</tbody></table>{{if festivalList.length}}<ul class="festival-list clearfix">{{each(index, text) festivalList}}<li><span class="festival-dot"></span>${text}</li>{{/each}}</ul>{{/if}}</div>',weeks:'{{each(i, item) list}}<li {{if item.color}}class="${item.color}"{{/if}}>${item.name}</li>{{/each}}',styles:'.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.m-cld{width:560px;border:1px solid #ddd;color:#234;background-color:#fff;-webkit-box-shadow:0 8px 20px 0 rgba(0,41,99,.2);box-shadow:0 8px 20px 0 rgba(0,41,99,.2)}.cld-hd{position:relative}.m-cld .prev-btn:before{content:"\\e32a"}.m-cld .next-btn:before{content:"\\e28a"}.m-cld .next-btn,.m-cld .prev-btn{font-size:18px;position:absolute;color:#666;cursor:pointer;top:12px}.m-cld .next-btn:hover,.m-cld .prev-btn:hover{color:#2681ff}.m-cld .disabled .next-btn,.m-cld .disabled .prev-btn{color:#ddd;cursor:default}.m-cld .prev-btn{left:20px}.m-cld .next-btn{right:20px}.cld-hd .month-label{float:left;width:50%;color:#333;letter-spacing:0;-webkit-box-sizing:border-box;box-sizing:border-box;text-align:center;font-size:18px}.cld-hd .month-label.month-label-1st{padding-left:7px}.cld-hd .month-label.month-label-2st{padding-right:7px}.month-hd{padding:12px 0}.week-hd{-webkit-box-sizing:border-box;box-sizing:border-box;list-style:none;float:left;width:50%;text-align:center;padding:0 7px 2px 14px;margin-bottom:10px}.week-hd li{float:left;width:14.28%;font-size:13px;font-size:12px;color:#333;letter-spacing:0;text-align:center}.cld-bd .date-tbl td .festival,.week-hd li.festival{color: ${festivalFontColor}}.cld-bd .date-tbl td .weekend-sa,.week-hd li.weekend-sa{color:${saturdayFontColor}}.cld-bd .date-tbl td .weekend-su,.week-hd li.weekend-su{color: ${sundayFontColor}}.week-hd-2nd{padding:0 14px 0 7px}.cld-bd{padding:0 7px}.cld-bd .hr{background-color:#e4e4e4;height:1px;clear:both}.cld-bd .month-con{width:50%;float:left;padding:0 7px;-webkit-box-sizing:border-box;box-sizing:border-box;margin-bottom:10px}.cld-bd .date-tbl{width:100%;border-collapse:collapse}.cld-bd .date-tbl td{text-align:center;font-size:14px;padding:0;width:14.28%}.cld-bd .date-tbl td .festival-dot:before{content: ""; top: 3px;right: 3px;background-color: ${festivalFontColor};position: absolute;width: 5px;height: 5px;border-radius: 5px;}.cld-bd .date-tbl td .cell{position:relative;padding:8px 0;cursor:pointer;line-height:1.3}.cld-bd .date-tbl td .cell:hover{background:${dateHoverBgColor};color:${dateHoverFontColor}}.cld-bd .date-tbl td .past-date{color:${pastDayFontColor};cursor:not-allowed}.cld-bd .date-tbl td .past-date:hover{color:${pastDayFontColor};background-color:#fff}.cld-bd .date-tbl td .active,.cld-bd .date-tbl td .active:hover{background:${dateSelectedBgColor};color:${dateSelectedFontColor}}.cld-bd .date-tbl td .interval{background:#5aa0ff;color:#fff}.cld-bd .date-tbl td .past-date:hover .festival-dot{background-color:#ccc}.cld-bd .festival-list{list-style:none;padding:0;font-size:12px;margin:6px 0 0}.cld-bd .festival-list li{margin-right:10px;color:#999}.cld-bd .festival-list li .festival-dot{background-color:${festivalFontColor};width:6px;height:6px;display:inline-block;vertical-align:middle;border-radius:6px;margin-right:5px}.cld-ft{position:relative;padding:10px}.cld-ft .local-list{color:#999;font-size:12px;padding:5px 0}.cld-ft .local-list li{text-align:center}.cld-ft .local-list li.local-list-date-range{color:#333;font-size:14px;padding-bottom:10px}.cld-ft .close-btn{cursor:pointer;text-align:center;position:absolute;float:right;width:24px;height:24px;line-height:24px;right:8px;bottom:8px;font-size:16px;color:#999}.cld-ft .close-btn:hover{color:#2681ff}.cld-single{width:284px}.cld-single .week-hd{padding-right:29px}.cld-single .cld-bd .month-con,.cld-single .cld-hd .month-label,.cld-single .cld-hd .week-hd{width:100%}.cld-single .month-2nd,.cld-single .month-label-2nd,.cld-single .week-hd-2nd{display:none}.cld-price{width:680px}.cld-price .date-tbl td{font-size:16px}.cld-price .date-tbl td .interval .price{color:#fff}.cld-bd .date-price td .price{font-size:12px;color:#91aebf}.cld-bd .date-price td .cell:hover .price{color:#fff}.cld-bd .date-price td .active .price{color:#fff}.cld-bd .date-price td .lowest .price{color:#f66}.cld-bd .date-price td .lowest:hover .price{color:#f66}@media only screen and (max-width:768px){.m-cld{width:360px}.cld-bd .month-con,.cld-hd .month-label,.cld-hd .week-hd{width:100%}.month-2nd,.month-label-2nd,.week-hd-2nd{display:none}.cld-ft .local-list{padding-bottom:8px}}@media only screen and (max-width:500px){.m-cld{width:100%}}'},festival:null},this.hasTouchstart="ontouchstart"in window&&/iphone|ipad|android/i.test(navigator.userAgent);var n=this;n.target=_(t),n.target.attr("readonly","readonly");var s=_.extend(!0,{},this.setting.template);if(e&&(this.setting=_.extend(!0,this.setting,e),e.options&&e.options.date)){var o=g.createDate(e.options.date);o&&(d=o)}this.setting.template=s,m=g.parseDateInt(d),n.uid="calendar"+n.target.uid(),this._fragment=document.createDocumentFragment();var r=!1;function l(){r||(n._init(),r=!0),n._hide_wait=!0,setTimeout(function(){n._hide_wait=!1},150),n.show()}this.setting.string.input&&n.target.value(this.setting.string.input),this.setting.options.showAlways?(l(),this._isShow=!1):n.target.bind("focus",l),this._initBefore(),this.setting.options.initDefaultDate&&this._initDefaultDate()};function i(){a.__inst&&a.__inst._isShow&&a.__inst._position&&a.__inst._position(!0)}a.prototype={_init:function(){this._initDependConfig(),this._parseFestivalData(),this._initTpl(),this._renderWeek(),_.browser.isAllIE||this._initContentScrollLite({scrollTarget:this.setting.options.scrollTarget,scrollBody:null,gap:this.setting.options.scrollGap,animSpeed:this.setting.options.scrollAnimatingSpeed})},_initDependConfig:function(){window.i18n_6001?this.i18n_6001=window.i18n_6001:this.i18n_6001={},window.i18n_6002?(this.i18n_6002=window.i18n_6002,this.setting.options.displayDateFormat=this.i18n_6002["key.calendar.selected_date_display_format"]||"mdeShortString",this.setting.options.displayShortYearFormat=this.i18n_6002["key.calendar.short_year_month_title_display_format"]||"ymShortString",this.setting.options.displayShortMonthFormat=this.i18n_6002["key.calendar.short_month_title_display_format"]||"mdShortString"):this.i18n_6002={},this.data.colors={sundayFontColor:this.i18n_6002["key.calendar.sunday_font_color"]||"#2E64B4",saturdayFontColor:this.i18n_6002["key.calendar.saturday_font_color"]||"#2E64B4",festivalFontColor:this.i18n_6002["key.calendar.festival_font_color"]||"#CC4921",festivalBgColor:this.i18n_6002["key.calendar.festival_bg_color"]||"#CC4921",pastDayFontColor:this.i18n_6002["key.calendar.past_day_font_color"]||"#ccc",todayFontColor:this.i18n_6002["key.calendar.today_font_color"]||"#fff",todayBgColor:this.i18n_6002["key.calendar.today_bg_color"]||"#5aa0ff",dateSelectedFontColor:this.i18n_6002["key.calendar.date_selected_font_color"]||"#fff",dateSelectedBgColor:this.i18n_6002["key.calendar.date_selected_bg_color"]||"#2681ff",dateHoverFontColor:this.i18n_6002["key.calendar.date_hover_font_color"]||"#fff",dateHoverBgColor:this.i18n_6002["key.calendar.date_hover_bg_color"]||"#5aa0ff"}},_initContentScrollLite:function(t){this._contentScrollLite=new e(t)},_initBefore:function(){var t=this.setting.options;this.container=_(t.container),this.step=2,this.setMinDate(t.minDate),t.maxDate&&(t.maxDate=g.createDate(t.maxDate),this._max=g.parseDateInt(t.maxDate)),t.startDate&&(this._start=g.parseDateInt(t.startDate)),t.endDate&&(this._end=g.parseDateInt(t.endDate)),t.prevInput&&(this.prevInput=this._getInputs(t.prevInput)),t.nextInput&&(this.nextInput=this._getInputs(t.nextInput)),t.nextInputRelate&&(this.nextInputRelate=this._getInputs(t.nextInputRelate)),t.relate&&(this.relate=this._getInputs(t.relate)),t.relateDisplay&&(this.relateDisplay=this._getInputs(t.relateDisplay))},_getInputs:function(t){var e=null,i=null;if(this._isArray(t))for(var a=0,n=t.length;a<n;a++)i=_(t[a]),e?i.length&&e.push(i[0]):i.length&&(e=i);else(i=_(t)).length&&(e=i);return e},_isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},_parseFestivalData:function(){!this.setting.festival&&this.i18n_6001&&(this.setting.festival=this.i18n_6001)},_makeWeekList:function(t){if(t){var e=this.setting,i=e.base,a=e.weekStart,n=0;if(this.i18n_6002["key.calendar.week_start"])try{n=parseInt(this.i18n_6002["key.calendar.week_start"])}catch(r){}else n=a[i.site]||a["default"];var s=e.colours[i.site]||e.colours["default"],o=t.split(/,|\_/g).map(function(t,e){var i=null;return 0===e?i=s.sunday:6===e&&(i=s.saturday),{value:e,name:t,color:i}});if(n)for(;n--;)o.push(o.shift());return o}},_renderWeekBefore:function(){var t=this.setting,e=t.locales,i=null;return window.l10n&&l10n.l10n||e&&e.calendar&&e.calendar.ShortWeeks?i=this._makeWeekList(window.l10n&&l10n.l10n&&l10n.l10n["key.l10n.datetime.weekday.names.abbreviations"]||e&&e.calendar&&e.calendar.ShortWeeks):t.string.week&&(i=this._makeWeekList(t.string.week)),i},_renderWeek:function(){var t=this._renderWeekBefore();if(t){var e=_.tmpl.render(this.setting.template.weeks,{list:t});this._week1.html(e),this._week2.html(e)}},_initTpl:function(){var a=this.uid,t=this.setting.template,e=this.setting.options,i=_.tmpl.render(t.styles,this.data.colors);i='<hr style="display:none;line-height:0;font-size:0;border:none;" /><style>'+i.replace(/(\s*)([^\{\}]+)\{/g,function(t,e,i){return e+i.replace(/([^,]+)/g,"#"+a+" $1")+"{"})+"</style>";var n=document.createElement("div");n.id=a;var s=_(n).css({zIndex:this.setting.options.zindex||100});this._body=_("body"),this._singleWrapper=this._body.offset().width<768,this._singleWrapper&&(this.step=1);var o=this.setting.string.localTime,r=this.setting.base.language,l="";(window.i18n_6002&&window.i18n_6002["key.calendar.all_dates_are_in_locale_time"]||o&&o.EN)&&(l=window.i18n_6002&&window.i18n_6002["key.calendar.all_dates_are_in_locale_time"]||o[r]||o.EN),this._hasPriceList=this.setting.priceList&&this.setting.priceList.currency,s.html(i+_.tmpl.render(t.wrapper,{single:this._singleWrapper,currency:this._hasPriceList,uid:"c_"+a,uarrowid:"carrow_"+a,um1id:"cm1_"+a,um2id:"cm2_"+a,uw1id:"cw1_"+a,uw2id:"cw2_"+a,localTime:l,hasCloseBtn:e.hasCloseBtn,displayRangeDate:e.displayRangeDate})),this._layout=s,this._content=s.find("#c_"+a),this._header1=s.find("#cm1_"+a),this._header2=s.find("#cm2_"+a),this._week1=s.find("#cw1_"+a),this._week2=s.find("#cw2_"+a),this._arrowIcon=s.find("#carrow_"+a),this._prevMonthBtn=s.find("#prev-month"),this._nextMonthBtn=s.find("#next-month"),this._dateRangeText=s.find("#date-range-text"),this.step<2&&(this._header2.css("display","none"),this._week2.css("display","none"));var d=this;function h(t){var e=t.target||t.srcElement;d._handleEvent(e),d._blurCanClose=!1,"select"!=e.nodeName.toLowerCase()&&t.stop()}this._blurCanClose=!0,this.hasTouchstart?s.bind("touchend",h):s.bind("mousedown",h),this.prevInput&&(d._tempEnd=!1,s.bind("mousemove",function(t){var e=t.target;d.isIn(d._content[0],e)?d._checkHoverColor(t.target):d._tempEnd&&(d._tempEnd=!1,d.update())}))},addWinEvent:function(){var t=this.setting.options,e=this;t.showAlways||(this.hasTouchstart?_(document).bind("touchend",this.dochandle.bind(this)):_(document).bind("click",this.dochandle.bind(this)),this.target.bind("blur",function(){e._blurCanClose&&e.hide()}),this._layout.bind("mouseup",function(t){e._blurCanClose=!0}))},removeWinEvent:function(){this.setting.options.showAlways||(this.hasTouchstart?_(document).unbind("touchend",this.dochandle):_(document).unbind("click",this.dochandle),this.target.unbind("blur"),this._layout.unbind("mouseup"))},dochandle:function(t){this._hide_wait||(this._checkExternalClick(t),this._blurCanClose=!0)},setMinDate:function(t){if(t){if("#"==t)this.setting.options.minDate=d,i=m;else{var e=g.createDate(t),i=!1;e&&(this.setting.options.minDate=e,i=g.parseDateInt(e))}this._min=i}else this._min=!1},isIn:function(t,e){for(var i=e;i&&9!==i.nodeType;){if(i==t)return!0;i=i.parentNode}return!1},_disableNextMonth:function(){var t=this.setting.classNames;this._nextMonthBtn.addClass(t.disabled)},_ableNextMonth:function(){var t=this.setting.classNames;this._nextMonthBtn.removeClass(t.disabled)},_disablePrevMonth:function(){var t=this.setting.classNames;this._prevMonthBtn.addClass(t.disabled)},_ablePrevMonth:function(){var t=this.setting.classNames;this._prevMonthBtn.removeClass(t.disabled)},_checkExternalClick:function(t){var e=t.target||t.srcElement,i=this.uid;if(!this.isIn(this._layout[0],e)&&e!=this.target[0]&&e.id!=i){if("OPTION"==e.nodeName||"#document"==e.nodeName)return!1;this.hide()}},_handleEvent:function(t){var e=t.getAttribute("data-bind"),i=_(t).hasClass(this.setting.classNames.disabled);if(e)switch(e){case"close":this.hide();break;case"prev":!i&&this.changeDrawMonth(-1);break;case"next":!i&&this.changeDrawMonth(1);break;case"select":this.select(t)}return!1},changeDrawMonth:function(t){this._drawDate=g.addMonth(this._drawDate,t),this.update()},show:function(){this.addWinEvent();var t=this,e=this.setting.options;if(!t._isShow){a.__inst&&a.__inst.uid!=this.uid&&a.__inst.hide(),(a.__inst=this)._updateOptions();var i=this.setting.listeners;t.update(),i.onBeforeShow&&i.onBeforeShow.call(this),t.container.append(t._layout),e.showAlways||(this._position(),this._layout.cover()),i.onShow&&i.onShow.call(this),t._isShow=!0,_.browser.isAllIE||t._contentScrollLite.checkScroll(t.container)}},_position:function(t){var e=this.prevInput?this.prevInput.offset():this.target.offset(),i=this._body.offset(),a=0,n=_(window).width(),s=0,o=this._singleWrapper?360<=n?360:n:678;o+e.left>i.width?(a=e.left-(o+e.left-i.width+(360<=n?10:0)),s=o+e.left-i.width+50):(a=e.left+(this.setting.options.offset.left||0),s=100),this._arrowIcon.css({left:s+"px"}),o<=320&&this._layout.find(".mod-calender").css({width:320}),this._layout.css({left:a+"px",top:e.top+e.height+(this.setting.options.offset.top||0)+"px",position:"absolute"})},_startAnimating:function(){this.data.animInfo={startData:{opacity:0},endData:{opacity:1},times:0},this._animating()},_animating:function(){this.data._animatingTimer=requestAnimationFrame(function(){this.data.animInfo.startData.opacity<=1&&(this.data.animInfo.startData.opacity+=.05),this._layout.css({opacity:this.data.animInfo.startData.opacity}),this.data.animInfo.times++<20&&this._animating()}.bind(this))},_clearAnimating:function(){cancelAnimationFrame(this.data._animatingTimer)},hide:function(){this._isShow&&(this.setting.options.showAlways||this._layout.uncover(),this._fragment.appendChild(this._layout[0]),this._isShow=!1,this.target.blur()),this.removeWinEvent()},_updateOptions:function(){var t=this.target.data(),e=this.setting.options;for(var i in t)switch(i){case"startDate":var a=g.parseDateInt(t.startDate);a!=this._start&&(e.startDate=t.startDate,this._start=a);break;case"endDate":var n=g.parseDateInt(t.endDate);n!=this._end&&(e.endDate=t.endDate,this._end=n);break;case"minDate":t.minDate=g.createDate(t.minDate);var s=t.minDate;s&&s!=e.minDate&&(e.minDate=s,this.setMinDate(s),this.currentDate&&delete this.currentDate);break;case"maxDate":t.maxDate=g.createDate(t.maxDate);var o=g.parseDateInt(t.maxDate);o&&o!=this._max&&(e.maxDate=t.maxDate,this._max=o);break;case"showWeek":e.showWeek=t.showWeek;break;case"permit":e.permit=t.permit;break;case"prohibit":e.prohibit=t.prohibit;break;case"weekday":e.weekday=t.weekday;break;case"prevInput":this.prevInput=this._getInputs(t.prevInput);break;case"nextInput":this.nextInput=this._getInputs(t.nextInput);break;case"currentDate":this._updateCurrentDate(t.currentDate)}if(this.prevInput){this._tempEnd=!1;var r=this.prevInput.data("currentDate")||this.prevInput.value(),l=g.createDate(r);l&&(this.setting.options.startDate=l,this._start=g.parseDateInt(l))}this.setCurrentDate(this.target),this._start&&this.currentDate&&(e.endDate=this.currentDate,this._end=this.currentDint),this.setting.options.displayRangeDate&&t.startDate&&t.currentDate?this._updateDateRangeText(t.startDate,t.currentDate):this.updateDateRangeText(),this._parseDrawMonth()},_updateDateRangeText:function(t,e){var i=this.setting.dateTimeFormat,a=this.setting.options.displayDateFormat;this.updateDateRangeText({startDateText:i(t,a),endDateText:i(e,a),rangeNum:g.daysOfDate(t,e)})},_initDefaultDate:function(){this.setting.options.defaultDate&&(this._updateCurrentDate(this.setting.options.defaultDate),this.nextInput&&this.nextInput.length&&!this.nextInput.data("startDate")&&this.nextInput.data("startDate",this.target.data("currentDate")))},updateCurrentDate:function(t){this._updateCurrentDate(t)},updateDateRangeText:function(t){this._dateRangeText&&t?this._dateRangeText.css({display:"block"}).html(_.tmpl.render(this.setting.string.rangeDateText,t)):this._dateRangeText&&this._dateRangeText.css({display:"none"}).html("")},_updateCurrentDate:function(t){if(t){t=g.createDate(t);var e=g.format(t,this.setting.options.serverDateFormat),i=g.format(t,this.setting.options.CNDateFormat);i=this.setting.dateTimeFormat(t,this.setting.options.displayDateFormat),this.target.data({currentDate:t,serverDate:e}),this.target.value(i),this.relate&&this.relate.length&&this.relate.value(e),this.relateDisplay&&this.relateDisplay.length&&(this.relateDisplay.data({currentDate:t,serverDate:e}),this.relateDisplay.value(i))}},_parseDrawMonth:function(){var t=!1,e=this.setting.options;this.currentDate?this._drawDate=this.currentDate:(e.defaultDate?t=g.createDate(e.defaultDate):this._min&&(t=e.minDate),t||(t=d),this._drawDate=t),!this._singleWrapper&&this.target.data("startDate")&&parseInt(g.format(g.createDate(this._drawDate),"yyyymm"),10)>parseInt(g.format(g.createDate(this.target.data("startDate")),"yyyymm"),10)&&(this._drawDate=g.addMonth(this._drawDate,-1))},setCurrentDate:function(t){var e=t.data("currentDate")||t.value();if(e){var i=g.createDate(e);this.isPassDate(i)||(this.currentDate=i,this.currentDint=g.parseDateInt(i))}},setDate:function(t,e){t&&(d=g.createDate(t),m=g.parseDateInt(d),this.setting.options.showWeek)},update:function(){this.setting.options.showLimits&&(this._disablePrev=!1,this._disableNext=!1);var t=this,e=this.step,i=1,a=this._create(this._drawDate),n=a.output;if(this._header1.html(a.module.title),i<e)for(;i<e;i++)a=this._create(g.addMonth(this._drawDate,i),"other"),this._header2.html(a.module.title),n+=a.output;if(setTimeout(function(){t._content.html(n)}),this.setting.options.showOptions){var s=this._layout.find("select"),o=this;s.bind("change",function(){o._drawDate=new Date(s[0].value,1*s[1].value-1,1),o.update()})}this.setting.options.showLimits&&(this._disablePrev?this._disablePrevMonth():this._ablePrevMonth(),this._disableNext?this._disableNextMonth():this._ableNextMonth())},_create:function(t,e){var i=this.setting,a=i.options,n=t.getMonth(),s=i.template,o="",r=this._renderCalendar(t);if(a.showOptions){var l=n+1,d=t.getFullYear(),h=a.minDate?a.minDate.getFullYear():1900,c=a.maxDate?a.maxDate.getFullYear():2030;o='<select name="year">';for(var u=h;u<=c;u++)o+=u==d?'<option value="'+u+'" selected="selected">'+u+"</options>":'<option value="'+u+'">'+u+"</options>";o+="</select>年 ",o+='<select name="m">';for(var p=1;p<13;p++)o+=p==l?'<option value="'+p+'" selected="selected">'+p+"</options>":'<option value="'+p+'">'+p+"</options>";o+="</select>月"}else o=this.setting.dateTimeFormat(t,this.setting.options.displayShortYearFormat);var f={title:o,hasPriceList:this._hasPriceList,monthclass:e?" month-2nd":" month-1st",data:r.data,festivalList:r.festivalArr};return{output:_.tmpl.render(s.calendar,f),module:f}},_renderCalendar:function(t){for(var e=g.get(t),i=t.getMonth(),a=this,n=this.setting,s=n.base,o=n.weekStart,r=o[s.site]||o["default"],l=0,d=[],h=this.setting.classNames,c=[],u={"default":function(t){return t.m==i?a._parseCellDate(t,h,i,c):{day:"",date:null,classes:h.blankdate}},all:function(t){return a._parseCellDate(t,h,i,c)}}[this.setting.options.render];l<42;l++)d.push(u(e[l]));if(r)for(var p=!1;r--;)if(d[0].day&&!p){p=!0;var f=d.slice(-6);f.push(d.shift()),d=f.concat(d.slice(0,d.length-6))}else d.push(d.shift());return{data:d,festivalArr:c}},_checkFestival:function(t){var e=t.substring(5),i=this.setting.festival||{};return i[t]?i[t]:!!i[e]&&i[e]},_checkHasPrice:function(t){if(!this.setting.priceList)return!1;var e=t.substring(5),i=this.setting.priceList.data;return i[t]?i[t]:!!i[e]&&i[e]},_parseCellDate:function(t,e,i,a){var n=this.setting,s=n.base,o=n.colours[s.site]||n.colours["default"],r=t.k,l=t.i,d=t.w,h=' data-id="'+r+'"',c=[],u={day:t.d,date:r,ym:t.y+t.m,classes:"",attr:""};l==m&&c.push(e.today),0===t.w?c.push(o.sunday):6===t.w&&c.push(o.saturday);var p=this._checkFestival(r);if(this._checkPassDate(r,l,d))if(p&&a.length<n.options.festivalDisplayLength&&(u.isfestival=!0,a.push(n.options.festivalHasDateTime?n.dateTimeFormat(r,n.options.displayShortMonthFormat)+" "+p:p),o.festival&&c.push(o.festival)),this._start)if(this._start==l){u.isfestival&&c.push(e.festival),c.push(e.select);var f=this._checkHasPrice(r);f&&(c.push(f[0]),u.price=f[1])}else c.push(e.nothismonth);else c.push(e.nothismonth);else h+=' data-bind="select"',f=this._checkHasPrice(r),p&&a.length<n.options.festivalDisplayLength&&(u.isfestival=!0,a.push(n.options.festivalHasDateTime?n.dateTimeFormat(r,n.options.displayShortMonthFormat)+" "+p:p),o.festival&&c.push(o.festival)),f&&(c.push(f[0]),u.price=f[1]),this.currentDate&&this.currentDint==l&&(u.isfestival&&c.push(e.festival),c.push(e.select)),this._start&&(this._start==l&&(u.isfestival&&c.push(e.festival),c.push(e.select)),this._end&&l>this._start&&l<this._end&&c.push(e.range),this._tempEnd&&l>Math.max(this._start,this._end||0)&&l<this._tempEnd&&c.push(e.range));return 0<c.length&&(u.classes=c.join(" ")),u.attr=h,u},isPassDate:function(t){var e=g.format(t),i=g.parseDateInt(t),a=t.getDay();return this._checkPassDate(e,i,a)},_checkPassDate:function(t,e,i){var a=this.setting.options;return!(!a.prohibit||-1===a.prohibit.indexOf(t))||(!a.permit||-1===a.permit.indexOf(t))&&(this._min&&e<this._min?(this.setting.options.showLimits&&(this._disablePrev=!0),!0):this._max&&e>this._max?(this.setting.options.showLimits&&(this._disableNext=!0),!0):-1===a.weekday.indexOf(i))},_checkHoverColor:function(t){if("select"==t.getAttribute("data-bind")){var e=0,i=t.getAttribute("data-id");if(i){var a=g.parseDateInt(i);a&&a>Math.max(this._start,this._end||0)&&(e=a)}else e=0;this._tempEnd!=e&&(this._tempEnd=e,this.update())}},select:function(t){var e,i=t.getAttribute("data-id"),a=g.createDate(i),n=g.format(a,this.setting.options.serverDateFormat),s=this.target[0],o=g.format(a,this.setting.options.CNDateFormat);e=this.setting.dateTimeFormat(a,this.setting.options.displayDateFormat),this.target.value(e),this.target.data({currentDate:o,serverDate:n}),this.relate&&this.relate.length&&this.relate.value(n),this.relateDisplay&&(this.relateDisplay.value(e),this.relateDisplay.data({currentDate:o,serverDate:n})),this.currentDate=a,this.currentDint=g.parseDateInt(a);var r=this;this.setting.options.displayRangeDate&&this.target.data("startDate")&&!this.nextInput&&this._updateDateRangeText(this.target.data("startDate"),this.currentDate);var l=this.setting.listeners;this.target.trigger("change");var d=this.nextInput,h=null,c=null;if(d&&d.length){var u=new Date(a.getFullYear(),a.getMonth(),a.getDate()+this.setting.options.nextInterval),p=g.format(u,this.setting.options.serverDateFormat);h=g.format(u,this.setting.options.CNDateFormat),c=h,this.nextInput.data({startDate:o,minDate:u}),this.nextInput.data("currentDate")&&g.parseDateInt(u)>g.parseDateInt(this.nextInput.data("currentDate"))?(this.nextInput.data("currentDate",h),c=this.setting.dateTimeFormat(u,this.setting.options.displayDateFormat),this.nextInput.value(c)):this.nextInput.data("currentDate")?this.nextInput.data("currentDate")&&(u=this.nextInput.data("currentDate"),p=g.format(u,this.setting.options.serverDateFormat),h=g.format(u,this.setting.options.CNDateFormat),c=this.setting.dateTimeFormat(u,this.setting.options.displayDateFormat)):(this.nextInput.data({currentDate:u,serverDate:p}),c=this.setting.dateTimeFormat(u,this.setting.options.displayDateFormat),this.nextInput.value(c)),this.nextInputRelate&&this.nextInputRelate.length&&this.nextInputRelate.value(p),l.onChange&&setTimeout(function(){l.onChange.call(r,s,n,o,e,p,h,c)}),this.setting.options.focusNext&&setTimeout(function(){d[0].focus()})}else l.onChange&&setTimeout(function(){l.onChange.call(r,s,n,o,e)});this.setting.options.showWeek,this.setting.options.showAlways?this.update():this.setting.options.hideWaiting?setTimeout(function(){this.hide()}.bind(this),this.setting.options.hideWaiting):this.hide()},getWhatDay:function(t){var e=g.format(t),i=this.setting.string,a=this._checkFestival(e);if(a)return a[0].replace("c_","pic_");var n=d,s=new Date(n.getFullYear(),n.getMonth(),n.getDate()),o=parseInt((t-s)/864e5,10);return 0<=o&&o<3?i.todayText[o]:i.weekText[t.getDay()]},setWeek:function(t){var e=null;e=t?_(t):this.target;var i=g.createDate(e.value());if(i){var a=this.getWhatDay(i);a&&105<=e.offset().width&&e.css({"background-image":"url(//pic.c-ctrip.com/cquery/"+a+".png)","background-position":"right center","background-repeat":"no-repeat"})}else e.css({"background-image":"none"})}},_(window).bind("resize",i).bind("scroll",i),_.fn.datePickerV2=function(e){return this.each(function(t){return new a(t,e)})},"function"==typeof define&&define.amd&&define("cDatePickerV2",["i18n_6001","i18n_6002","l10n","cQuery","CIDate"],function(t,e,i){return window.i18n_6001||(window.i18n_6001=t),window.i18n_6002||(window.i18n_6002=e),window.l10n?window.l10n.l10n=e||window.i18n_6002:i.l10n=e||window.i18n_6002,a}),window.CIDatePickerV2=a}(cQuery);