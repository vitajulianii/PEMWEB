define(["cQueryPro","CIDate","cDatePickerV2","cAddress","modTrainsSearchBoxI18n"],function(t,i,e,s,a){window.htmlEncode=function(t){var i=document.createElement("div");return i.appendChild(document.createTextNode(t)),i.innerHTML};var n=function(i){var e={curNum:1,minNum:0,maxNum:9,gap:1,target:null,css:{cutBtn:"._button-minus",addBtn:"._button-plus",btnDisState:"disable",counter:"._counter",errorState:"ipt-error"},listeners:{cut:function(){},add:function(){},change:function(){}},template:'<div><i class="_button-minus">-</i><span class="_counter">${curNum}</span><i class="_button-plus">+</i></div>'};this.options=t.extend(!0,e,i),this.ui={},this.data={},this.init()};n.prototype={constructor:n,init:function(){this.render(),this.getElements(),this.updateTarget(),this.updateState(),this.bindEvent()},getElements:function(){var i=this.options.css;this.options.target&&(this.ui.target=t(t.isArray(this.options.target)?this.options.target.join(","):this.options.target)),this.ui.cutBtn=this.$el.find(i.cutBtn),this.ui.addBtn=this.$el.find(i.addBtn),this.ui.counter=this.$el.find(i.counter)},updateTarget:function(){this.ui.target&&this.ui.target.value(this.options.curNum)},setNum:function(t){t>=this.options.minNum&&t<=this.options.maxNum&&(this.options.curNum=t,this.updateState())},getNum:function(){return this.options.curNum},updateStateByData:function(i){this.options=t.extend(!0,this.options,i),this.updateState()},showErrorState:function(){this.$el.addClass(this.options.css.errorState)},hideErrorState:function(){this.$el.removeClass(this.options.css.errorState)},updateCounter:function(){this.updateTarget(),this.ui.counter.html(this.options.curNum)},updateAddState:function(t){var i=this.options.css;t?this.ui.addBtn.addClass(i.btnDisState):this.ui.addBtn.removeClass(i.btnDisState)},updateCutState:function(t){var i=this.options.css;t?this.ui.cutBtn.addClass(i.btnDisState):this.ui.cutBtn.removeClass(i.btnDisState)},updateState:function(){var t=this.options.css,i=this.options;i.curNum==i.minNum?this.ui.cutBtn.addClass(t.btnDisState):this.ui.cutBtn.removeClass(t.btnDisState),i.curNum==i.maxNum?this.ui.addBtn.addClass(t.btnDisState):this.ui.addBtn.removeClass(t.btnDisState)},createEl:function(i){var e=t(document.createElement("div"));return e.html(i),e.children()},render:function(){this.$el=this.createEl(t.tmpl.render(this.options.template,this.options)),this.el=this.$el[0]},cutNum:function(){var t=this.options;t.curNum-t.gap<t.minNum?t.curNum=t.minNum:t.curNum-=t.gap,this.updateCounter(t.curNum),this.updateState(),this.options.listeners.cut&&this.options.listeners.cut(t.curNum),this.options.listeners.change&&this.options.listeners.change(this.options.curNum)},addNum:function(){var t=this.options;t.curNum+t.gap>t.maxNum?t.curNum=t.maxNum:t.curNum+=t.gap,this.updateCounter(t.curNum),this.updateState(),this.options.listeners.cut&&this.options.listeners.cut(t.curNum),this.options.listeners.change&&this.options.listeners.change(this.options.curNum)},bindEvent:function(){var i=this,e=this.options.css;this.$el.on("click",e.cutBtn,function(){t(this).hasClass(e.btnDisState)||i.cutNum()}).on("click",e.addBtn,function(){t(this).hasClass(e.btnDisState)||i.addNum()})}};var r=function(i,e){var s={css:{elName:"DepartCity",relate:"#DepartCityId",errorState:"ipt-error"},alias:["name_py","name","code","alias"],i18n:{inputEmpty:"",sameInputValue:"",suggestionTitle:"",suggestionTip:""},tmpl:{},suggestionSource:"",listeners:{onChange:function(){}},jsonpFilter:""};this.options=t.extend(!0,s,e),this.$el=t(i),this.ui={},this.ui.el=i,this.init()};r.prototype={init:function(){return this.findElements(),this.initAddress(),this.initTip(),this},findElements:function(){var t=this.options.css;this.ui.relate=t.relate,this.ui.display=t.display},getInputValue:function(){return this.ui.el.value().trim()},setInputValue:function(t){this.ui.el.value(t)},getRelateValue:function(){return this.ui.relate.value().trim()},setRelateValue:function(t){this.ui.relate.value(t)},updateUserInput:function(t,i){this.ui.el.value(t),this.ui.relate.value(i)},initAddress:function(){var t=this,i=this.options,e=i.css,s=i.tmpl;s.message.i18n=i.i18n,this.addrInstance=this.ui.el.regMod("address","1.0",{name:e.elName,isFocusNext:!0,isAutoCorrect:!1,relate:{code:this.ui.relate},offset:5,source:{alias:i.alias,suggestion:i.suggestionSource},template:s,jsonpFilter:i.jsonpFilter,message:s.message});var a=null,n=!1;this.addrInstance.method("bind","change",function(){a=arguments[1]&&arguments[1].data?arguments[1].data:null}),this.addrInstance.method("bind","userinput",function(i,e){var s,r=!1;arguments[1]&&arguments[1].data?(s=arguments[1].data.split("|"),t.ui.el.value(s[1]),t.ui.relate.value(s[0]),r=!0,a=null):a?(s=a.split("|"),t.ui.el.value(s[1]),t.ui.relate.value(s[0]),a=null,r=!0):n&&(t.ui.el.value(""),t.ui.relate.value("")),n=!1,t.ui.display&&t.ui.display.value&&t.ui.display.value(t.ui.el.value())}),this.addrInstance.method("bind","filter",function(t,i){n=!0,setTimeout(function(){i.find("a").first().length&&(a=i.find("a").first().attr("data"))},0)}),this.ui.el.on("focus",function(){t.hideTip()})},checkIsAvilable:function(t){var i=this.getInputValue();return i?t&&t===i?(this.showTip(this.options.i18n.sameInputValue),!1):(this.hideTip(),!0):(this.showTip(this.options.i18n.inputEmpty),!1)},createEl:function(i){var e=t(document.createElement("div"));return e.html(i),e.children()},initTip:function(){this.ui.error=this.createEl('<span class="msg-box msg-error" style="position: absolute;"></span>'),cQuery.browser.isIE7&&this.ui.error.css({top:"60px",left:0}),this.ui.error.hide(),this.ui.el.parent().append(this.ui.error)},showTip:function(t){this.ui.error.html(t).show(),this.ui.el.addClass(this.options.css.errorState)},hideTip:function(){this.ui.error.hide(),this.ui.el.removeClass(this.options.css.errorState)}};var u=function(i,e){var s={options:{prevInput:null,minDate:"#",maxDate:null,startDate:null,endDate:null,nextInput:null,nextInputRelate:null,nextInterval:0,relate:"",relateDisplay:"",defaultDate:null},listeners:{onBeforeShow:null,onShow:null,onChange:null},i18n:{is_empty:""}};this.options=t.extend(!0,s,e),this.$el=t(i),this.ui={el:i},this.init()};u.prototype={init:function(){return this.findElements(),this.initInputState(),this.initCalendar(),this},findElements:function(){},initInputState:function(){this.ui.el.attr("readonly","readonly")},getInputValue:function(){return this.ui.el.value().trim()},setInputValue:function(t){this.ui.el.value(t)},updateCurrentDate:function(t){this.inst.updateCurrentDate&&this.inst.updateCurrentDate(t)},initCalendar:function(){this.inst=new e(this.$el,{options:this.options.options,listeners:this.options.listeners})},checkIsAvilable:function(){var t=this.getInputValue();return t?!0:(this.showTip(this.options.i18n.is_empty),!1)},showTip:function(t){}};var o=function(i){var e={searchParams:{hidAdultNum:1,hidChildNum:0,hidYoungNum:0,hidOldNum:0},numberCounter:{css:{cutBtn:"._button-minus",addBtn:"._button-plus",btnDisState:"disable",counter:"._counter",errorState:"ipt-error"},template:'<div><i class="_button-minus">-</i><span class="_counter">${curNum}</span><i class="_button-plus">+</i></div>'},paramsStoreKey:"_eurorail_s_param",i18n:a,hasTitle:!1,addrJSONPUrl:"/eurotrains/address/GetTrainLocation?keyword=${unescape(key)}",suggestionUrl:"/eurotrains/address/GetHotTrainLocation",listUrl:"/eurotrains/list",minPassengerNum:1,maxPassengerNum:9,css:{DepartureCity:"#DepartureCity",DepartureStation:"#DepartureStation",DepartureCityCode:"#DepartureCityCode",ArrivalCity:"#ArrivalCity",ArrivalStation:"#ArrivalStation",ArrivalCityCode:"#ArrivalCityCode",DepartDate:"#DepartDate",HidDepartDate:"#HidDepartDate",TrainNo:"#TrainNo",SwitchDirIcon:".icon-dir-switch",switchCircle:".i-dir-switch-circle",switchCirclelAnim:"o-loading-circle",SearchSubmit:"#SearchSubmit",TrainForm:"#EurorainForm",SearchBoxArg:"#searchboxArg",passenger:".passenger",passengerNo:".passenger-no",passengerNoText:".passenger-no span",passengerNoList:".passenger-no-list div",passengerNoListUl:".passenger-no-list",timeWrap:".c-sel-time",timeItem:"._time",timeText:"._time span",timeList:".c-time-list",timeListItem:"li",eurorailRule:"._eurorail_rule",DepartHourIpt:"#DepartHourIpt",hidAdultNum:"#hidAdultNum",hidChildNum:"#hidChildNum",hidYoungNum:"#hidYoungNum",hidOldNum:"#hidOldNum",closeEurorailPop:".europe-train",seatPreference:"#SeatPreference",seatPreInfo:".seat-preference-info",seatModal:".what-is-seat-preference"},config:{calendarMinDate:0,calendarMaxDate:119,LanguageCode:"",SiteCode:""},data:a.data.default_searchbox,template:{suggestion:'{{if data.length}}<div class="s-tab-recommend active">{{each(i, item) data}}<div class="s-tab-table {{if item.isLast}} last {{/if}}"><p>${item.typeName}</p><table width="100%" border="0" cellpadding="0" cellspacing="0"><tbody>{{each(j, inner) item.list}}{{if j%4 == 0}}<tr>{{/if}}{{if inner.data}}<td width="25%"><a style="display:block; max-width: 150px; margin: 0 10px 0 0; overflow: hidden; text-overflow: ellipsis;" data="${inner.data}">${inner.cityName}</a></td>{{else}}<td width="25%"></td>{{/if}}{{/each}}</tbody></table></div>{{/each}}<div class="pop-clo CQ_suggestionClose"></div></div>{{/if}}',suggestionStyle:"                    .s-tab-recommend td:hover {background:#74a2dd;color:#fff;}                    .s-tab-recommend td:hover a {color:#fff; text-decoration:none}                ",filter:'{{if list.length}}<ul class="s-tab-associate" style="display: block;">{{each (i,item) list}}<li class="{{if /countryorcity/i.test(item.data)}} s-tab-table-city {{else}} s-tab-table-station {{/if}}"><a data="${item.data}">{{if /stationorcountry/i.test(item.data)}} <i></i> {{/if}}${item.right}</a></li>{{/each}}</ul>{{else}} <div class="o-search-no-result">{{tmpl message.noFilterResult}}</div>{{/if}}',filterStyle:" ",message:{filterResult:"<span>${htmlEncode(unescape(val))}</span>, "+a.locals.filterResult,noFilterResult:"<span>${htmlEncode(unescape(val))}, "+a.locals.noFilterResult},body:'<form action="${listUrl}" class="mod-con-eu" method="get" id="EurorainForm"><ul class="search-items clearfix"><li class="s-item s-item-l"><label for="">${i18n.LabelText_UpperFrom} </label><input class="c-ipt ipt-borderless" type="text" name="DepartureCity" placeholder="${i18n.V2_Trains_List_Label_Filter_DepartureStation}" id="DepartureCity" /></li><li class="dir-switch"><a href="javascript:;"><i class="c-icon icon-dir-switch"></i></a></li><li class="s-item s-item-r"><label for="">${i18n.LabelText_UpperTo}</label><input class="c-ipt ipt-borderless" type="text" name="ArrivalCity" id="ArrivalCity" placeholder="${i18n.V2_Trains_List_Label_Filter_ArrivalStation}" /></li><li class="s-item s-item-l"><label for="">${i18n.Home_LabelText_Depart}</label><div class=""><input class="c-ipt date" type="text"  id="DepartDate" readonly="readonly" /><div class="c-sel-time"><div class="_time"><span>06:00</span><div class="triangle"></div></div><ul class="c-time-list"><li>00:00</li><li>01:00</li><li>02:00</li><li>03:00</li><li>04:00</li><li>05:00</li><li>06:00</li><li>07:00</li><li>08:00</li><li>09:00</li><li>10:00</li><li>11:00</li><li>12:00</li><li>13:00</li><li>14:00</li><li>15:00</li><li>16:00</li><li>17:00</li><li>18:00</li><li>19:00</li><li>20:00</li><li>21:00</li><li>22:00</li><li>23:00</li></ul></div></div></li><li class="s-item s-item-r"><label for="">${i18n.Passengers}</label><div class="c-ipt passenger"><div class="passenger-no"><span>1</span><i></i></div><ul class="passenger-no-list"><li>${i18n.key_eurorail_searchbox_adult_26_59}<div><i class="disable">-</i><span>1</span><i class="disable">+</i></div></li><li>${i18n.key_eurorail_searchbox_child_4_15} <div><i>-</i><span>0</span><i>+</i></div> </li><li>${i18n.key_eurorail_searchbox_young_15_25} <div><i>-</i><span>0</span><i>+</i></div> </li><li>${i18n.key_eurorail_searchbox_old_60} <div><i>-</i><span>0</span><i>+</i></div> </li><li><a class="_eurorail_rule">${i18n.key_eurorail_searchbox_agerule}</a></li></ul></div><input class="c-ipt ipt-gray" type="text" name="TrainNo" id="TrainNo" style="display: none; "/></li></ul><div class="search-btn" style="margin-top: 25px;"><button class="c-btn btn-key btn-xl btn-book-avalible" id="SearchSubmit">${i18n.V2_Trains_Search_Button_Search}</button></div><input id="DepartureCityCode" type="hidden" name="DepartureCityCode"/><input id="ArrivalCityCode" type="hidden" name="ArrivalCityCode"/><input id="DepartureStation" type="hidden" name="DepartureStation"/><input id="ArrivalStation" type="hidden" name="ArrivalStation"/><input id="HidDepartDate" type="hidden" name="DepartDate"/><input id="DepartHourIpt" type="hidden" name="DepartHourIpt" value="06:00"/><input id="hidAdultNum" type="hidden" name="hidAdultNum" /><input id="hidChildNum" type="hidden" name="hidChildNum" /><input id="hidYoungNum" type="hidden" name="hidYoungNum" /><input id="hidOldNum" type="hidden" name="hidOldNum" /></form>',eurorailRulePopup:'<div c-layout="tile" class="p-pop pop-eurorail" id="pop-eurorail" style="display:none"><div class="pop-table"><div class="pop-cell"><div class="pop-con"><p class="pop-title">${i18n.key_eurorail_age_title}<p class="pop-tip">${i18n.key_eurorail_age_rules}</p><table class="pop-table-ages" width="100%" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="category-name">${i18n.key_eurorail_age_rules_2}</td><td class="category-cnt">${i18n.key_eurorail_age_rules_2_1}</td></tr><tr><td class="category-name">${i18n.key_eurorail_age_rules_3}</td><td class="category-cnt">${i18n.key_eurorail_age_rules_3_1}</td></tr><tr><td class="category-name">${i18n.key_eurorail_age_rules_4}</td><td class="category-cnt">${i18n.key_eurorail_age_rules_4_1}</td></tr><tr><td class="category-name">${i18n.key_eurorail_age_rules_6}</td><td class="category-cnt">${i18n.key_eurorail_age_rules_6_1}</td></tr><tr><td colspan="2"><table class="pop-table-children" width="100%" border="0" cellpadding="0" cellspacing="0"><tbody><tr class="title"><td class="child-age">${i18n.key_eurorail_age_child}</td><td class="countries">${i18n.key_eurorail_age_Countries}</td></tr><tr><td class="child-age">3-11</td><td class="countries">${i18n.key_eurorail_age_Lithuania}</td></tr><tr><td class="child-age">4-11</td><td class="countries">${i18n.key_eurorail_age_Multi}</tr><tr><td class="child-age">3-11</td><td class="countries">${i18n.key_eurorail_age_Norway_Ireland}</td></tr><tr><td class="child-age">5-15</td><td class="countries">${i18n.key_eurorail_age_Britain}</td></tr><tr><td class="child-age">6-11</td><td class="countries">${i18n.key_eurorail_age_Belgium_Others}</td></tr><tr><td class="child-age">6-13</td><td class="countries">${i18n.key_eurorail_age_Hungary_Serbia}</td></tr><tr><td class="child-age">6-14</td><td class="countries">${i18n.key_eurorail_age_Germany_Others}</td></tr><tr><td class="child-age">6-15</td><td class="countries">${i18n.key_eurorail_age_Switzerland_Others}</td></tr><tr><td class="child-age">6-16</td><td class="countries">${i18n.key_eurorail_age_Finland}</td></tr></tbody></table></td></tr><tr><td class="category-name">${i18n.key_eurorail_age_infant} </td></td><td class="category-cnt">${i18n.key_eurorail_infant_detail} </td></tr><tr><td class="category-name">${i18n.key_eurorail_trans_lines} </td></td><td class="category-cnt">${i18n.key_eurorail_trans_lines_detail} </td></td></tr></tbody></table><p class="pop-tip">${i18n.key_eurorail_trans_lines_extra_p1} </td></p><p class="pop-tip">${i18n.key_eurorail_trans_lines_extra_p2} </td></p><p class="pop-tip">${i18n.key_eurorail_trans_lines_extra_p3} </td></p><div class="pop-clo europe-train"></div></div></div></div></div>'},hook:{search:function(){}}};this.options=t.extend(!0,e,i),this.ui={},this.data={}};return o.prototype={constructor:o,init:function(){return this.$el=this.render(),this.ui.el=this.$el,this.getElements(),this.loadSuggestion(function(t){this.initAddressInputs(t),this._initSearchForm()}.bind(this)),this.options.seatEnum?this.ui.passengerNoText.html(this.options.seatEnum[1]):this.initNumberCounter(),this.initCalendar(),this.bindEvents(),this.addEurorailPop(),this},showEurorailPop:function(){this.ui.eurorailPop.show()},hideEurorailPop:function(){this.ui.eurorailPop.hide()},addEurorailPop:function(){var i=this;this.ui.eurorailPop=this.createEl(t.tmpl.render(this.options.template.eurorailRulePopup,{i18n:this.options.i18n.locals})),this.ui.eurorailPop.find(this.options.css.closeEurorailPop).on("click",function(){i.hideEurorailPop(),setTimeout(function(){i.ui.passenger.addClass("active")})}),t("body").append(this.ui.eurorailPop)},loadSuggestion:function(i){t.ajax(this.options.suggestionUrl,{onsuccess:function(e){var s=[];try{s=t.parseJSON(e.responseText)}catch(a){}i&&i(s)},onerror:function(t){},onabort:function(t){}})},getElements:function(){var t=this.options.css;this.ui.DepartureCity=this.$el.find(t.DepartureCity),this.ui.DepartureStation=this.$el.find(t.DepartureStation),this.ui.DepartureCityCode=this.$el.find(t.DepartureCityCode),this.ui.ArrivalCity=this.$el.find(t.ArrivalCity),this.ui.ArrivalStation=this.$el.find(t.ArrivalStation),this.ui.ArrivalCityCode=this.$el.find(t.ArrivalCityCode),this.ui.DepartDate=this.$el.find(t.DepartDate),this.ui.HidDepartDate=this.$el.find(t.HidDepartDate),this.ui.TrainNo=this.$el.find(t.TrainNo),this.ui.SearchSubmit=this.$el.find(t.SearchSubmit),this.ui.SearchBoxArg=this.$el.find(t.SearchBoxArg),this.ui.SwitchDirIcon=this.$el.find(t.SwitchDirIcon),this.ui.passenger=this.$el.find(t.passenger),this.ui.passengerNo=this.$el.find(t.passengerNo),this.ui.passengerNoText=this.$el.find(t.passengerNoText),this.ui.passengerNoList=this.$el.find(t.passengerNoList),this.ui.DepartHourIpt=this.$el.find(t.DepartHourIpt),this.ui.hidAdultNum=this.$el.find(t.hidAdultNum),this.ui.hidChildNum=this.$el.find(t.hidChildNum),this.ui.hidYoungNum=this.$el.find(t.hidYoungNum),this.ui.hidOldNum=this.$el.find(t.hidOldNum),this.ui.timeWrap=this.$el.find(t.timeWrap),this.ui.timeItem=this.$el.find(t.timeItem),this.ui.timeText=this.$el.find(t.timeText),this.ui.timeList=this.$el.find(t.timeList),this.ui.passengerNoListUl=this.$el.find(t.passengerNoListUl),this.ui.seatPreference=this.$el.find(t.seatPreference),this.ui.seatPreInfo=this.$el.find(t.seatPreInfo),this.ui.seatModal=this.$el.find(t.seatModal)},render:function(){return this.createEl(t.tmpl.render(this.options.template.body,{listUrl:this.options.listUrl,hasTitle:this.options.hasTitle,i18n:this.options.i18n.locals}))},createEl:function(i){var e=t(document.createElement("div"));return e.html(i),e.children()},updateAllNumberCounter:function(){var t=this.data.adultNumCounterInst.getNum()+this.data.childNumCounterInst.getNum()+this.data.youngNumCounterInst.getNum()+this.data.olderNumCounterInst.getNum();t==this.options.minPassengerNum?(this.data.adultNumCounterInst.updateCutState(!0),this.data.childNumCounterInst.updateCutState(!0),this.data.youngNumCounterInst.updateCutState(!0),this.data.olderNumCounterInst.updateCutState(!0)):t==this.options.maxPassengerNum?(this.data.adultNumCounterInst.updateAddState(!0),this.data.childNumCounterInst.updateAddState(!0),this.data.youngNumCounterInst.updateAddState(!0),this.data.olderNumCounterInst.updateAddState(!0)):(this.data.adultNumCounterInst.updateState(),this.data.childNumCounterInst.updateState(),this.data.youngNumCounterInst.updateState(),this.data.olderNumCounterInst.updateState()),this.ui.passengerNoText.html(t),this.ui.hidAdultNum.value(this.data.adultNumCounterInst.getNum()),this.ui.hidChildNum.value(this.data.childNumCounterInst.getNum()),this.ui.hidYoungNum.value(this.data.youngNumCounterInst.getNum()),this.ui.hidOldNum.value(this.data.olderNumCounterInst.getNum())},updateTimeText:function(t){this.ui.DepartHourIpt.value(t),this.ui.timeText.html(t)},initNumberCounter:function(){var t=this,i=this.getSearchParams();this.data.adultNumCounterInst=new n({css:this.options.numberCounter.css,template:this.options.numberCounter.template,curNum:parseInt(i.hidAdultNum),minNum:1,maxNum:9,listeners:{change:function(i){t.updateAllNumberCounter()}}}),this.data.childNumCounterInst=new n({css:this.options.numberCounter.css,template:this.options.numberCounter.template,curNum:parseInt(i.hidChildNum)||0,minNum:0,maxNum:9,listeners:{change:function(i){t.updateAllNumberCounter()}}}),this.data.youngNumCounterInst=new n({css:this.options.numberCounter.css,template:this.options.numberCounter.template,curNum:parseInt(i.hidYoungNum)||0,minNum:0,maxNum:9,listeners:{change:function(i){t.updateAllNumberCounter()}}}),this.data.olderNumCounterInst=new n({css:this.options.numberCounter.css,template:this.options.numberCounter.template,curNum:parseInt(i.hidOldNum)||0,minNum:0,maxNum:9,listeners:{change:function(i){t.updateAllNumberCounter()}}}),this.ui.passengerNoList.eq(0).replaceWith(this.data.adultNumCounterInst.$el),this.ui.passengerNoList.eq(1).replaceWith(this.data.childNumCounterInst.$el),this.ui.passengerNoList.eq(2).replaceWith(this.data.youngNumCounterInst.$el),this.ui.passengerNoList.eq(3).replaceWith(this.data.olderNumCounterInst.$el),this.updateAllNumberCounter()},initAddressInputs:function(t){var i=this.options.i18n.locals,e={inputEmpty:i.Alert_ProvideDepCityName,sameInputValue:i.same_city,suggestionTitle:i.Top_Destinations,suggestionTip:i.Side_Tipname},s=this.options.addrJSONPUrl;this._insFromAddr=new r(this.ui.DepartureCity,{css:{elName:this.ui.DepartureCity.attr("name"),relate:this.ui.DepartureCityCode,display:this.ui.DepartureStation},i18n:e,tmpl:this.options.template,suggestionSource:t,jsonpFilter:s}),this._insToAddr=new r(this.ui.ArrivalCity,{css:{elName:this.ui.ArrivalCity.attr("name"),relate:this.ui.ArrivalCityCode,display:this.ui.ArrivalStation},i18n:{inputEmpty:i.Alert_ProvideArrCityName,sameInputValue:i.same_city,suggestionTitle:i.Top_Destinations,suggestionTip:i.Side_Tipname},tmpl:this.options.template,suggestionSource:t,jsonpFilter:s,listeners:{onChange:function(t,i){}}})},updateSelectedDate:function(t,i){this._instDepartDate&&this._instDepartDate.updateCurrentDate&&this._instDepartDate.updateCurrentDate(t),this.updateTimeText(i)},getSearchParams:function(){return this.options.searchParams&&this.options.searchParams.DepartureCity&&this.options.searchParams.ArrivalCity?this.options.searchParams:t.storage.get(this.options.paramsStoreKey)||this.options.searchParams||{}},initCalendar:function(){var t=this,e=this.getSearchParams(),s=i.createDate(),a=s,n=a.addDays(this.options.config.calendarMaxDate-1),r=a.addDays(1);r=e&&e.DepartDate&&(i.isBefore(a,e.DepartDate)||i.isSame(a,e.DepartDate))?i.toCNDateFormat(e.DepartDate):i.toCNDateFormat(r),e&&e.DepartHourIpt&&(t.options.trainType&&"jp"===t.options.trainType||this.updateTimeText(e.DepartHourIpt)),this._instDepartDate=new u(this.ui.DepartDate,{options:{minDate:a,maxDate:n,relate:[this.ui.HidDepartDate],relateDisplay:null,defaultDate:r},listeners:{onChange:function(e,s,a,n,r,u,o){var l=new Date,d=l.getHours()+1;t.options.trainType&&"jp"===t.options.trainType||(i.dateFormat(l,"yyyy-mm-dd")===a?(d=9>d?"0"+d:d,t.updateTimeText(d+":00")):t.updateTimeText("06:00"))}}})},isActive:function(){return"block"===this.$el.css("display")},searchBefore:function(t){if(this.options.hook&&this.options.hook.search&&"function"==typeof this.options.hook.search)try{t.name="trains",this.options.hook.search(t)}catch(i){throw new Error(i)}},show:function(){this.$el&&this.$el.show()},hide:function(){this.$el&&this.$el.hide()},checkFormIsAvilable:function(){return this._insFromAddr.checkIsAvilable()&&this._insToAddr.checkIsAvilable(this._insFromAddr.getInputValue())?(this._saveSearchForm(),!0):void 0},_saveSearchForm:function(){for(var i=0,e=this._initFieldsArr.length,s={};e>i;i++)if(this.ui[this._initFieldsArr[i]])try{s[this._initFieldsArr[i]]=this.ui[this._initFieldsArr[i]].value()}catch(a){throw new Error(a)}s.DepartDate=this.ui.HidDepartDate.value(),t.storage.set(this.options.paramsStoreKey,s)},_initFieldsArr:["DepartureCity","ArrivalCity","DepartureCityCode","ArrivalCityCode","DepartHourIpt","DepartureStation","ArrivalStation","hidAdultNum","hidChildNum","hidYoungNum","hidOldNum"],_initSearchForm:function(){var t=0,i=this._initFieldsArr.length,e=(this.options.data,this.getSearchParams());if(e)for(;i>t;t++)if(this.ui[this._initFieldsArr[t]])try{e[this._initFieldsArr[t]]&&this.ui[this._initFieldsArr[t]].value(e[this._initFieldsArr[t]])}catch(s){throw new Error(s)}},updateHidDepartDate:function(t){t&&this.ui.HidDepartDate.value(t)},switchDir:function(){var t=this.ui.DepartureCity.value(),i=this.ui.DepartureCityCode.value();this.ui.DepartureCity.value(this.ui.ArrivalStation.value()),this.ui.DepartureStation.value(this.ui.ArrivalStation.value()),this.ui.DepartureCityCode.value(this.ui.ArrivalCityCode.value()),this.ui.ArrivalCityCode.value(i),this.ui.ArrivalStation.value(t),this.ui.ArrivalCity.value(t)},bindEvents:function(){var i=this,e=this.options.css;if(this.ui.SearchSubmit.on("click",function(e){e.preventDefault(),i.checkFormIsAvilable()&&("undefined"!=typeof IBU&&IBU.ui.PopLoading&&IBU.ui.PopLoading.getInstance().show(),i.searchBefore(t.storage.get(i.options.paramsStoreKey)),t(this).css("cursor","wait"),i.$el.submit())}),this.ui.SwitchDirIcon.length){var s=this.$el.find(e.switchCircle).removeClass(e.switchCirclelAnim);this.ui.SwitchDirIcon.bind("click",function(){s.removeClass(e.switchCirclelAnim).addClass(e.switchCirclelAnim),i.switchDir(),setTimeout(function(){s.removeClass(e.switchCirclelAnim)},1e3)})}this.$el.on("click",e.passengerNo,function(){t(this).parent().toggleClass("active")}),this.options.seatEnum&&this.ui.passengerNoListUl.on("click","li",function(e){i.ui.passengerNoText.html(i.options.seatEnum[t(this).data("seat-index")]),t(this).closest(".passenger").removeClass("active"),i.ui.seatPreference.val(t(this).data("seat-val"))}),this.ui.seatPreInfo&&this.ui.seatPreInfo.on("mouseenter",function(t){i.ui.seatModal.show()}).on("mouseleave",function(t){i.ui.seatModal.hide()}),this.$el.on("click",e.timeItem,function(e){var s=t(this).closest(".c-sel-time");s.hasClass("active")?s.removeClass("active"):(i.ui.timeWrap.removeClass("active"),s.addClass("active"))}),this.ui.timeWrap.on("click",e.timeListItem,function(){var s=t(this);i.options.seatEnum?(s.closest(".c-sel-time").removeClass("active"),t(this).closest(".c-sel-time").find(e.timeText).html(s.text()),t("#"+s.closest(".c-time-list").data("type")).val(s.text())):(i.updateTimeText(s.text()),i.ui.timeWrap.removeClass("active"))}),this.$el.on("click",e.eurorailRule,function(t){t.preventDefault(),t.stopPropagation(),i.showEurorailPop()}),t("body").on("click",function(s){var a=t(s.target);a.parents(e.passenger).length||i.ui.passenger.removeClass("active"),a.parents(e.timeWrap).length||i.ui.timeWrap.removeClass("active")})}},o});