var console=console||{};console.log=console.log||function(){},function(){window._rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){return window.setTimeout(t,16)};var i=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.clearTimeout;$.Utils=$.Utils||{},$.Utils.requestAnimationFrame=function(t){return window._rAF(t)},$.Utils.cancelAnimationFrame=function(t){i(t)}}(),function(){var o="undefined"!=typeof jQuery&&jQuery||cQuery,t=function(t,i){this.$el=o(t),this.el=this.$el[0],this.opts=o.extend({},{viewModel:{driftNum:0,fixScrollTop:-60},css:{drift:"full_fixed",tabItem:"a",activeState:"active",scrollItems:[".room_table_con",".mod-hotel-description",".mod-hotel-review",".mod-hotel-facil",".mod-hotel-policy"]},scrollUpdate:function(t){}},i),this.init()};t.prototype={constructor:t,init:function(){this.getOffsetTop(),this.fixedScrollTop=this.$el.height()-this.opts.viewModel.fixScrollTop,this.$items=this.$el.find(this.opts.css.tabItem),this.bindEvent()},getOffsetTop:function(){return this.opts.viewModel.driftNum=this.$el.offset().top},toDriftState:function(){this.$el.addClass(this.opts.css.drift)},goDefaultState:function(){this.$el.removeClass(this.opts.css.drift)},selectItemByIndex:function(t){var i=this.opts.css;this.$items.removeClass(i.activeState).eq(t).addClass(i.activeState)},checkIsDrift:function(t){var i=this.opts.css.scrollItems,e=null,s=0;if(t>=this.opts.viewModel.driftNum){this.toDriftState();for(var a=this.opts.css.scrollItems.length;0<=a;a--)if((e=o(i[a])).length){if(s=e.offset().top,t+this.fixedScrollTop>=s)return void this.selectItemByIndex(a);this.selectItemByIndex(0)}}else this.goDefaultState(),this.selectItemByIndex(0)},changeDriftState:function(t){t>=this.opts.viewModel.driftNum?this.toDriftState():this.goDefaultState()},checkScrollIndex:function(t){var i=this.opts.css.scrollItems;this.$doc.scrollTop(o(i[t]).offset().top-this.fixedScrollTop)},bindEvent:function(){var e=this,t=this.opts.css,i=null;this.$el.on("click",t.tabItem,function(t){t.preventDefault();var i=o(this).index();e._flag=!0,e.checkScrollIndex(i)}),this.$doc=o(document).on("scroll",function(){var t=e.$doc.scrollTop();if(e._flag)return e._flag=!1,e.changeDriftState(t),!1;i&&clearTimeout(i),i=setTimeout(function(){e.checkIsDrift(t),e.opts.scrollUpdate&&o.isFunction(e.opts.scrollUpdate)&&e.opts.scrollUpdate.call(e,e.$el,t)},50)})}};var i=function(t,i){this.opts=o.extend({css:{bigPicBody:".show_big_pic",bigPrevBtn:".prev",bigNextBtn:".next",big360Btn:".pic_360",bigMoreBtn:".more",big360State:"htl_pic_360",bigImage:".htl_pic img",big360AnimBody:".pic_360_body",playBtn:".play",pauseBtn:".pause",viewPic:".show_view_pic a",listMain:".show_s_pic",listBody:".htl_pic_slist",listItem:"li",activeState:"active",previousArrow:".previous_arrow",nextArrow:".next_arrow",tabBody:".pic_type_tab",tabItem:"a",filterBody:".pic_fliter",filterItem:"a",close:".close"},data:[],i18n:{roomTypes:{},uploadTypes:[]},tabItemTpl:'{{each(index, item) $data}}<a class="{{if index == $data.index}} active {{/if}}" href="#" data-index="${index}">${item.tabText} (${item.tabCount})</a>{{/each}}',listItemTpl:'{{each(index, item) data}}<li class="{{if index == $data.index}} active {{/if}}" {{if item.img360}} data-img360="${item.img360}" {{/if}} data-index="${index}" data-type="${item.imageType}" data-big-img="${item.imgMax}"><a href="javascript:void(0)"><img src="${item.imgMin}" alt=""></a></li>{{/each}}',openMoreCallback:function(){},closeMoreCallback:function(){},open360BoxCallback:function(t){},close360BoxCallback:function(){}},i),this.$el=t,this.ui={},this.data={},this.data.tabIndex=0,this.data.animOrientation=!0,this.data.tabData=[],this.init()},e=function(t,i){this.$el=o.isCDom(t)?t:o(t),this.el=this.$el[0],this.opts=o.extend({},{viewModel:{isFirst:!0,isLast:!1,curNum:1,count:20,title:"",roomName:""},data:[],listTemplate:'{{each(index, item) $data}}<li class="{{if index == 0 }} active {{/if}}"><a href="javascript:void(0)"><img {{if item.is360}} data-img360="${item.big}" {{/if}} data-title="${item.title}" data-big-img="${item.big}" src="${item.small}" alt="">{{if item.is360}}<i class="pic_360"></i>{{/if}}</a></li>{{/each}}',template:'<img src="${imgSrc}" alt="${title}"><strong class="title">${title}</strong><span class="num"><em class="cur">${curNum}</em>/${count}</span>',roomInfoListTemplate:'<tbody>{{each(i, record) list}} {{if i == list.length - 1}}<tr><td colspan="2"> <strong>${record.itemName}</strong>${record.itemDetail} </td></tr> {{else}}  {{if (i%2)==0}} <tr>{{/if}} <td> <strong>${record.itemName}</strong>${record.itemDetail} </td>{{/if}}{{/each}}</tbody>',css:{prevBtn:".prev",nextBtn:".next",playBtn:".play",pauseBtn:".pause",icon360:".pic_360",bigBox:".show_big_pic",smallBox:".show_s_pic",bigImgBox:".htl_pic",title:".pop_hd",smallListBox:".htl_pic_slist",detailTable:".detail_con_table",listItem:".htl_pic_slist li",close:".close",active:"active",roomtip:".room-tip"},itemUpdateCallback:function(){}},i),this.ui={},this.init()};e.prototype={constructor:e,init:function(){return this.findElements(),this.addMask(),this.showBox(),this.positionBox(),this.updateTitle(),this.renderList(),this.renderTable(),this.findListItem(),this.toDefState(),this.setItemsIndex(this.ui.items),this.updateCurNum(parseInt(this.opts.viewModel.curNum,10)),this.opts.viewModel.elRangeModel=this.getElRangeModel(),this.updateBtnState(),this.bindEvent(),this.selectItem(this.ui.items.eq(this.opts.viewModel.curNum-1)),this},updateByData:function(t){t&&(this.showBox(),this.opts.data=t.data,this.opts.viewModel=t.viewModel,this.renderList(),this.renderTable(),this.updateTitle(),this.findListItem(),this.toDefState(),this.setItemsIndex(this.ui.items),this.updateCurNum(parseInt(this.opts.viewModel.curNum,10)),this.opts.viewModel.elRangeModel=this.getElRangeModel(),this.updateBtnState(),this.selectItem(this.ui.items.eq(this.opts.viewModel.curNum-1)))},findElements:function(){var t=this.opts.css;this.ui.detailTable=this.$el.find(t.detailTable),this.ui.roomtip=this.$el.find(t.roomtip),this.ui.bigImgBox=this.$el.find(t.bigImgBox),this.ui.prevBtn=this.$el.find(t.prevBtn),this.ui.nextBtn=this.$el.find(t.nextBtn),this.ui.playBtn=this.$el.find(t.playBtn),this.ui.pauseBtn=this.$el.find(t.pauseBtn),this.ui.smallBox=this.$el.find(t.smallBox),this.ui.smallListBox=this.$el.find(t.smallListBox),this.ui.title=this.$el.find(t.title)},updateTitle:function(){this.ui.title[0].innerHTML=this.opts.viewModel.title||""},renderTable:function(){this.ui.detailTable.html(cQuery.tmpl.render(this.opts.roomInfoListTemplate,this.opts.data.roomInfo)),this.ui.roomtip.html(this.opts.data.roomDescription)},findListItem:function(){this.ui.items=this.$el.find(this.opts.css.listItem),this.opts.viewModel.count=this.ui.items.length},renderList:function(){this.opts.data&&this.opts.data.baseRoomPicList&&this.opts.data.baseRoomPicList.length?(this.ui.smallBox.parent().show(),this.ui.smallListBox.html(cQuery.tmpl.render(this.opts.listTemplate,this.opts.data.baseRoomPicList))):this.ui.smallBox.parent().hide()},renderBigImgBox:function(t){this.ui.bigImgBox.html(o.tmpl.render(this.opts.template,t))},addMask:function(){var t=document.createElement("div");this.ui.mask=o(t),o("body").append(this.ui.mask),this.refreshMask()},showBox:function(){this.$el.show(),this.ui.mask.show()},hideBox:function(){this.$el.hide(),this.ui.mask.hide()},refreshMask:function(){var t=o(window);this.ui.mask.css({position:"fixed",width:t.width(),height:t.height(),top:0,left:0,zIndex:1e3,opacity:.2,backgroundColor:"rgb(0, 0, 0)"})},positionBox:function(){var t=o(window);this.$el.css({zIndex:1001,position:"fixed",left:0,top:0,marginLeft:(t.width()-this.$el.width())/2,marginTop:(t.height()-this.$el.height())/2})},setItemsIndex:function(t){t.each(function(t,i){"number"==typeof t?o(this).data("index",t):t.data("index",i)})},getElRangeModel:function(){var t=this.$el.offset().top;return{minTop:t,maxTop:t+this.$el.height()}},clearSelected:function(){var t=this.opts.css.active;this.$el.find("."+t).removeClass(t)},updateListScrollTop:function(t){this.ui.smallBox.animate({scrollTop:this.ui.smallBox.scrollTop()+t},400)},_curShow360ImgSrc:"",_is360ImgLoaded:!(i.prototype={constructor:i,init:function(){this.show(),this.getElements(),this._initData(),this.ui.tabBody.length&&1<this.data.topTabData.length&&this.renderTab(),this.ui.filterBody.length&&1<this.data.tabData[this.data.tabIndex].filterTabData.length&&this.renderFilterTab(),this.updateList(),this.bindEvents()},findMoreImgIndex:function(t){var i=this.opts.data;if(i.length&&t)for(var e=0,s=i.length;e<s;e++)for(var a=0,n=i[e].length;a<n;a++)if(i[e][a].imgMax===t)return{tabIndex:e,showType:0,showTypeIndex:a}},openMore:function(t){this.show(),this.checkPlayAnim(),t?this.openMoreCallback(this.findMoreImgIndex(t)):this.openMoreCallback({tabIndex:this.data.tabIndex,showType:0,showTypeIndex:this.data.tabData[this.data.tabIndex].showTypeIndex})},showMore:function(t){t&&(this.show(),this.data.tabIndex=t.tabIndex,this.data.tabData[t.tabIndex].showType=t.showType,this.data.tabData[t.tabIndex].showTypeIndex=t.showTypeIndex,this.selectTabByIndex(t.tabIndex))},openMoreCallback:function(t){this.opts.openMoreCallback&&this.opts.openMoreCallback(t)},closeMore:function(){this.checkStopAnim(),this.hide(),this.closeMoreCallback()},closeMoreCallback:function(){this.opts.closeMoreCallback&&this.opts.closeMoreCallback()},open360Box:function(t){this.opts.open360BoxCallback&&this.opts.open360BoxCallback(t),this.checkStopAnim()},checkStopAnim:function(){this.data.current360IsAnim&&this.stop360Img()},checkPlayAnim:function(){this.data.current360ImgSrc&&!this.data.current360IsAnim&&this.play360Img()},close360Box:function(){this.opts.close360BoxCallback&&this.opts.close360BoxCallback(),this.checkPlayAnim()},show:function(){this.$el.show()},hide:function(){this.$el.hide()},updateListByShowType:function(t){var i=this.data.tabIndex,e=this.data.tabData;e[i].showType=t,e[i].showTypeIndex=0,this.updateList(),this.refreshListByPage(this.cacluAnimatingByShowIndex(e[i].showTypeIndex))},updateListByTabIndex:function(t){this.data.tabIndex=t,this.renderFilterTab(),this.updateList()},updateList:function(){var t=this.data.tabData,i=this.data.tabIndex,e=t[i].filterTabData[t[i].showType].data;this.renderList(e),this.updateListData(),this.updateListBtnsStateData(),this.refreshListBtnsState()},_initData:function(){for(var t=this.opts.data,i=this.opts.i18n.roomTypes,e=this.opts.i18n.uploadTypes,s=[],a=[],n=0,o=t.length;n<o;n++){var h={};s.push({tabText:e[n],tabCount:t[n].length}),a=[{tabType:"All",tabText:i.all,tabCount:t[n].length,data:t[n]}];for(var l=0,d=t[n].length;l<d;l++)h[t[n][l].imageType]?h[t[n][l].imageType].push(t[n][l]):h[t[n][l].imageType]=[t[n][l]];for(var r in h)a.push({tabType:r,tabText:i[r],tabCount:h[r].length,data:h[r]});this.data.tabData.push({showType:0,filterTabData:a,showTypeIndex:0,listBodyWidth:0,listItemWidth:0,listItemCount:0,listItemsWidth:0,listBeginState:0,listEndState:0,listAnimating:0,isFirstSelected:!0,isLastSelected:!1,isImg360Loading:!0,isPlaying:!0})}this.data.topTabData=s},getElements:function(){var t=this.opts.css;this.ui.bigPicBody=this.$el.find(t.bigPicBody),this.ui.bigPrevBtn=this.ui.bigPicBody.find(t.bigPrevBtn),this.ui.bigNextBtn=this.ui.bigPicBody.find(t.bigNextBtn),this.ui.bigImage=this.ui.bigPicBody.find(t.bigImage),this.ui.playBtn=this.ui.bigPicBody.find(t.playBtn),this.ui.pauseBtn=this.ui.bigPicBody.find(t.pauseBtn),this.ui.big360AnimBody=this.ui.bigPicBody.find(t.big360AnimBody),this.ui.tabBody=this.$el.find(t.tabBody),this.ui.listMain=this.$el.find(t.listMain),this.ui.listBody=this.$el.find(t.listBody),this.ui.filterBody=this.$el.find(t.filterBody),this.ui.previousArrow=this.ui.listMain.find(t.previousArrow),this.ui.nextArrow=this.ui.listMain.find(t.nextArrow)},updateListData:function(){var t=this.data.tabIndex,i=this.data.tabData[t],e=this.ui.listBody.children();i.listItemMarginRight=parseInt(e.first().css("marginRight"),10),i.listBodyWidth=this.ui.listMain.width()+i.listItemMarginRight,i.listItemWidth=e.first().width()+i.listItemMarginRight,i.listItemCount=e.length,i.listItemsWidth=i.listItemCount*i.listItemWidth,i.listAnimating=i.showTypeIndex*i.listItemWidth},updateListBtnsStateData:function(){var t=this.data.tabIndex,i=this.data.tabData[t];i.listAnimating<=0?i.listBeginState=!0:i.listBeginState=!1,i.listAnimating>=i.listItemsWidth-i.listBodyWidth?i.listEndState=!0:i.listEndState=!1},refreshListBtnsState:function(){var t=this.data.tabIndex,i=this.data.tabData[t];i.listBeginState?this.ui.previousArrow.hide():this.ui.previousArrow.show(),i.listEndState?this.ui.nextArrow.hide():this.ui.nextArrow.show()},selectTabByIndex:function(t){var i=this.ui.tabBody.children();i.removeClass(this.opts.css.activeState).eq(t).addClass(this.opts.css.activeState),this.switchTab(i.eq(t))},switchTab:function(t){this.stopAnimation();var i=t.data("index");t.addClass(this.opts.css.activeState).siblings().removeClass(this.opts.css.activeState),this.updateListByTabIndex(i),this.refreshListByPage(this.cacluAnimatingByShowIndex(this.data.tabData[this.data.tabIndex].showTypeIndex))},switchFilterTab:function(t){this.stopAnimation();var i=t.data("index");t.addClass(this.opts.css.activeState).siblings().removeClass(this.opts.css.activeState),this.updateListByShowType(i)},loaded360Callback:function(t){var i=this;t.src===this.data.current360ImgSrc&&(this.data.animStart=t.width/2,this.data.animating=this.data.animStart,this.data.animEnd=t.width+3*this.data.animStart,this.ui.big360AnimBody.css({left:-this.data.animating,width:3*t.width,height:t.height}).show().html(o.tmpl.render('<img src="${src}" style="float:left;position:relative;"/><img src="${src}" style="float:left;position:relative;"/><img src="${src}" style="float:left;position:relative;"/>',{src:t.src})),setTimeout(function(){i.play360Img()},50))},startAnimation:function(){var t=this;this.data.requestId=o.Utils.requestAnimationFrame(function(){t.data.animOrientation?(t.data.animating>t.data.animEnd&&(t.data.animating=t.data.animStart),t.ui.big360AnimBody.css("left",-t.data.animating++)):(t.data.animating<t.data.animStart&&(t.data.animating=t.data.animEnd),t.ui.big360AnimBody.css("left",-t.data.animating--)),t.startAnimation()})},stopAnimation:function(){o.Utils.cancelAnimationFrame(this.data.requestId)},loadImage:function(t){var i=this,e=new Image;e.onload=function(t){i.loaded360Callback(t.path[0]||e)},e.onerror=function(){},e.src=t},renderList:function(t){var i=this.data.tabData,e=this.data.tabIndex;t.length&&(this.ui.listBody.html(o.tmpl.render(this.opts.listItemTpl,{data:t,index:i[e].showTypeIndex})),i[e].listItemCount=t.length,this.adapterShowImage(t[i[e].showTypeIndex].img360,t[i[e].showTypeIndex].imgMax,i[e].showTypeIndex))},updateStateData:function(t){var i=this.data.tabIndex,e=this.data.tabData[i];1<e.filterTabData[e.showType].data.length?0===t?(e.isFirstSelected=!0,e.isLastSelected=!1):t===e.listItemCount-1?(e.isFirstSelected=!1,e.isLastSelected=!0):(e.isFirstSelected=!1,e.isLastSelected=!1):(e.isFirstSelected=!0,e.isLastSelected=!0),e.showTypeIndex=t},refreshBigBtns:function(){var t=this.data.tabIndex,i=this.data.tabData[t];i.isFirstSelected?this.ui.bigPrevBtn.hide():this.ui.bigPrevBtn.show(),i.isLastSelected?this.ui.bigNextBtn.hide():this.ui.bigNextBtn.show()},renderTab:function(){var t=this.data.topTabData;t.index=0,this.ui.tabBody.html(o.tmpl.render(this.opts.tabItemTpl,t))},renderFilterTab:function(){var t=this.data.tabData[this.data.tabIndex].filterTabData;t.index=this.data.tabData[this.data.tabIndex].showType,this.ui.filterBody.html(o.tmpl.render(this.opts.tabItemTpl,t))},adapterShowImage:function(t,i,e){this.updateStateData(e),this.refreshBigBtns(),this.ui.big360AnimBody.hide().empty(),this.ui.playBtn.hide(),this.ui.pauseBtn.hide(),this.stopAnimation(),t?(this.data.current360ImgSrc=t,this.loadImage(t),this.ui.bigImage.hide(),this.ui.bigImage.parent().addClass(this.opts.css.big360State)):i&&(this.data.current360ImgSrc="",this.data.current360IsAnim=!1,this.ui.bigImage.parent().removeClass(this.opts.css.big360State),this.showBigImage(i))},showBigImage:function(t,i){this.ui.bigImage.show().attr("src",t)},bigPrev:function(){var t=this.data.tabIndex,i=this.data.tabData[t],e=this.findListItemByIndex(i.showTypeIndex-1);this.showImageByItem(e),this.refreshListByPage(this.cacluAnimatingByShowIndex(i.showTypeIndex))},bigNext:function(){var t=this.data.tabIndex,i=this.data.tabData[t],e=this.findListItemByIndex(i.showTypeIndex+1);this.showImageByItem(e),this.refreshListByPage(this.cacluAnimatingByShowIndex(i.showTypeIndex))},refreshListByPage:function(){this.arrowAnimating(),this.updateListBtnsStateData(),this.refreshListBtnsState()},cacluAnimatingByShowIndex:function(t){var i=this.data.tabIndex,e=this.data.tabData[i],s=Math.floor(t*e.listItemWidth/e.listBodyWidth)*e.listBodyWidth;e.listItemsWidth>=e.listBodyWidth&&s>=e.listItemsWidth-e.listBodyWidth&&(s=e.listItemsWidth-e.listBodyWidth),e.listAnimating=s},showImageByItem:function(t){var i=t.data("bigImg"),e=t.data("img360"),s=(t.data("type"),t.data("index"));t.addClass(this.opts.css.activeState).siblings().removeClass(this.opts.css.activeState),this.adapterShowImage(e,i,s)},findListItemByIndex:function(t){return this.ui.listMain.find(this.opts.css.listItem).eq(t)},showListItemByIndex:function(){var t=this.findListItemByIndex(this.calcuShowIndexByAnimating());this.showImageByItem(t)},arrowPrev:function(){this.arrowCalcuAnimating("prev"),this.arrowAnimating(),this.updateListBtnsStateData(),this.refreshListBtnsState(),this.showListItemByIndex()},arrowNext:function(){this.arrowCalcuAnimating("next"),this.arrowAnimating(),this.updateListBtnsStateData(),this.refreshListBtnsState(),this.showListItemByIndex()},arrowAnimating:function(){var t=this.data.tabIndex,i=this.data.tabData[t];this.ui.listBody.css("marginLeft",-i.listAnimating)},arrowCalcuAnimating:function(t){var i=this.data.tabIndex,e=this.data.tabData[i];switch(t){case"prev":e.listAnimating-e.listBodyWidth<=0?e.listAnimating=0:e.listAnimating=e.listAnimating-e.listBodyWidth;break;case"next":e.listAnimating+e.listBodyWidth>=e.listItemsWidth-e.listBodyWidth?e.listAnimating=e.listItemsWidth-e.listBodyWidth:e.listAnimating=e.listAnimating+e.listBodyWidth}},calcuShowIndexByAnimating:function(){var t=this.data.tabIndex,i=this.data.tabData[t];return Math.floor(i.listAnimating/i.listItemWidth)},play360Img:function(){this.ui.playBtn.hide(),this.ui.pauseBtn.show(),this.data.current360IsAnim=!0,this.startAnimation()},stop360Img:function(){this.ui.playBtn.show(),this.ui.pauseBtn.hide(),this.data.current360IsAnim=!1,this.stopAnimation()},refreshResize:function(){var t=this.data.tabIndex,i=this.data.tabData[t];this.updateListData(),this.refreshListByPage(this.cacluAnimatingByShowIndex(i.showTypeIndex))},bindEvents:function(){var t,i,e,s=this,a=this.opts.css,n=(t=function(){s.refreshResize()},i=200,e=null,function(){e&&clearTimeout(e),e=setTimeout(t,i)});o(window).on("resize",function(){n()}),this.$el.on("click",a.viewPic,function(t){t.preventDefault();var i=o(this).children().attr("src");s.openMore(i)}).on("click",a.close,function(t){t.preventDefault(),s.closeMore()}),this.ui.bigPicBody.on("click",a.bigImage,function(t){t.preventDefault(),s.openMore()}).on("click",a.big360AnimBody,function(t){t.preventDefault(),s.openMore()}).on("click",a.bigPrevBtn,function(t){t.preventDefault(),s.bigPrev()}).on("click",a.bigNextBtn,function(t){t.preventDefault(),s.bigNext()}).on("click",a.big360Btn,function(t){t.preventDefault(),s.open360Box(o(this).data("src"))}).on("click",a.bigMoreBtn,function(t){t.preventDefault(),s.openMore()}).on("click",a.playBtn,function(t){t.preventDefault(),s.play360Img()}).on("click",a.pauseBtn,function(t){t.preventDefault(),s.stop360Img()}),this.ui.tabBody.on("click",a.tabItem,function(t){t.preventDefault();var i=o(this);i.hasClass(a.activeState)||s.switchTab(i)}),this.ui.listMain.on("click",a.previousArrow,function(t){t.preventDefault(),s.arrowPrev()}).on("click",a.nextArrow,function(){event.preventDefault(),s.arrowNext()}).on("mouseenter",a.listItem,function(t){t.preventDefault();var i=o(this);i.hasClass(a.activeState)||s.showImageByItem(i)}),this.ui.filterBody.on("click",a.filterItem,function(t){t.preventDefault();var i=o(this);i.hasClass(a.activeState)||s.switchFilterTab(i)})}}),_has360Img:!1,_animImg360Left:0,_animImg360FullPlayed:!1,selectItem:function(t){var i=this.opts.css,e=t.offset(),s=t.data("index"),a=t.find("img"),n=a.attr("data-big-img"),o=a.attr("data-title")||this.opts.viewModel.roomName,h=t.height(),l=a.data("img360");this.clear360Timer(),l?(this._curShow360ImgSrc=l,this._is360ImgLoaded=!1,this._has360Img=!0,this.resetOrientation(),this.loadImg(l)):(this.clearRequestId(),this.toDefState(),this._has360Img=!1),e.top<this.opts.viewModel.elRangeModel.minTop?this.updateListScrollTop(e.top-this.opts.viewModel.elRangeModel.minTop):e.top+h>this.opts.viewModel.elRangeModel.maxTop&&this.updateListScrollTop(e.top+h-this.opts.viewModel.elRangeModel.maxTop),this.updateCurNum(s+1),this.clearSelected(),this.animToBig(s,n,o),t.addClass(i.active)},updateCurNum:function(t){this.opts.viewModel.curNum=t,this.calcuViewModel()},updateBtnState:function(){this.opts.viewModel.isFirst?this.ui.prevBtn.hide():this.ui.prevBtn.show(),this.opts.viewModel.isLast?this.ui.nextBtn.hide():this.ui.nextBtn.show()},toDefState:function(){this.ui.playBtn.hide(),this.ui.pauseBtn.hide()},_startImg360Timer:null,initPlayState:function(t){var i=this;this.clear360Timer(),this._startImg360Timer=setTimeout(function(){i.showPlayState(),i.ui.img360=i.getBigBoxImg(),i.ui.img360.attr("src",t),i._animImg360Left=-(i.ui.img360.width()-i.ui.img360.parent().width()),i._has360Img&&i._is360ImgLoaded&&i.anim360Img(),i.showPauseState()},800)},clear360Timer:function(){this._startImg360Timer&&clearTimeout(this._startImg360Timer)},getBigBoxImg:function(){return this.$el.find(this.opts.css.bigBox).find("img")},_requestId:null,clearRequestId:function(){this._requestId&&o.Utils.cancelAnimationFrame(this._requestId)},_imgLeft:0,_aimImg:null,_orientation:!1,resetOrientation:function(){this._orientation=!1},anim360Img:function(){var t=this.getBigBoxImg();this._animImg360FullPlayed=!1,this._aimImg=t,this.clearRequestId(),this._imgLeft=0,this.requestAnim()},requestAnim:function(){var t=this;this.clearRequestId(),this._requestId=o.Utils.requestAnimationFrame(function(){t._orientation?t._imgLeft+=1:t._imgLeft-=1,t._imgLeft<=t._animImg360Left||Math.abs(t._imgLeft)<=0?(t._imgLeft<0?t._orientation=!0:t._orientation=!1,setTimeout(function(){t.requestAnim()},400)):t.requestAnim(),t._aimImg.css("left",t._imgLeft)})},showPlayState:function(){this.ui.playBtn.show(),this.ui.pauseBtn.hide()},showPauseState:function(){this.ui.playBtn.hide(),this.ui.pauseBtn.show()},loadImg:function(t,i,e){i=i||function(){},e=e||function(){};var s=this,a=document.createElement("img");(a=o(a).on("load",function(){s.isCurShowImg360(t)&&(s._is360ImgLoaded=!0,s.initPlayState(t)),i()}).on("error",function(){e()})).attr("src",t)},isCurShowImg360:function(t){return this._curShow360ImgSrc==t},animToBig:function(t,i,e){var s=this;s.renderBigImgBox({imgSrc:s._has360Img&&s._is360ImgLoaded?s._curShow360ImgSrc:i,title:e,curNum:t+1,count:s.opts.viewModel.count}),s._has360Img&&s._is360ImgLoaded&&s.anim360Img(),s.updateBtnState()},goPrev:function(){1!==this.opts.viewModel.curNum&&(this.opts.viewModel.curNum=this.opts.viewModel.curNum-1),this.selectItem(this.ui.items.eq(this.opts.viewModel.curNum-1))},goNext:function(){this.opts.viewModel.curNum!==this.opts.viewModel.count&&(this.opts.viewModel.curNum=this.opts.viewModel.curNum+1),this.selectItem(this.ui.items.eq(this.opts.viewModel.curNum-1))},calcuViewModel:function(){return this.opts.viewModel.isFirst=1===this.opts.viewModel.curNum,this.opts.viewModel.isLast=this.opts.viewModel.curNum===this.opts.viewModel.count,this.opts.viewModel},itemCallback:function(){this.opts.itemUpdateCallback&&this.opts.itemUpdateCallback.call(this)},bindEvent:function(){var e=this,s=this.opts.css;o(window).on("resize",function(){e.positionBox(),e.refreshMask()}),this.$el.on("click",s.listItem,function(t){t.preventDefault();var i=o(this);i.hasClass(s.active)||(e.selectItem(i),e.itemCallback())}).on("click",s.prevBtn,function(t){t.preventDefault(),e.goPrev(),e.itemCallback()}).on("click",s.nextBtn,function(t){t.preventDefault(),e.goNext(),e.itemCallback()}).on("click",s.playBtn,function(t){t.preventDefault(),e.showPauseState(),e.requestAnim()}).on("click",s.pauseBtn,function(t){t.preventDefault(),e.showPlayState(),e.clearRequestId()}).on("click",s.close,function(t){t.preventDefault(),e.hideBox()})}},cQuery.plugs=cQuery.plugs||{},cQuery.plugs.ScrollBuoy=t,cQuery.plugs.Scene3DSlide=i,cQuery.plugs.PopupScene3DSlide=e}();